% Capitolul 9: Seminar - Prophet și TBATS

\documentclass[9pt, aspectratio=169, t]{beamer}
\input{preamble}
\subtitle{Seminar 9: Prophet și TBATS}

\begin{document}

{
\setbeamertemplate{headline}{}
\setbeamertemplate{footline}{}
\begin{frame}
    \titlepage
\end{frame}
}


%=============================================================================
% OUTLINE
%=============================================================================
\begin{frame}{Cuprins Seminar}
    \tableofcontents
\end{frame}

%=============================================================================
% SECTION 1: REVIEW QUIZ
%=============================================================================
\section{Test de Recapitulare}

\begin{frame}{Test 1: Problema Sezonalității Multiple}
    \begin{alertblock}{Întrebare}
        De ce modelele SARIMA standard nu pot gestiona datele orare de consum electric?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item SARIMA poate gestiona doar date lunare
        \item SARIMA permite o singură perioadă sezonieră (parametrul $m$)
        \item SARIMA nu suportă componente de trend
        \item SARIMA necesită date normal distribuite
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 1: Răspuns}
    \begin{exampleblock}{Răspuns: B -- SARIMA permite o singură perioadă sezonieră}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.60\textheight, keepaspectratio]{ch9_quiz1_multiple_seasonality.pdf}
        \end{center}
        \vspace{-0.2cm}
        {\footnotesize
        \textbf{Esențial}: Datele orare au pattern-uri zilnice (24h), săptămânale (168h) și anuale (8760h). Parametrul unic $m$ din SARIMA nu poate captura simultan toate acestea.
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_quiz1\_multiple\_seasonality}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_quiz1_multiple_seasonality}
\end{frame}

\begin{frame}{Test 2: Acronimul TBATS}
    \begin{alertblock}{Întrebare}
        Ce reprezintă TBATS?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Trend, Baseline, ARMA, Transform, Seasonal
        \item Trigonometric, Box-Cox, ARMA, Trend, Seasonal
        \item Time-Based Automatic Time Series
        \item Temporal Bayesian Adaptive Trend System
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 2: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Trigonometric, Box-Cox, ARMA, Trend, Seasonal}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.48\textheight, keepaspectratio]{ch9_quiz2_tbats_components.pdf}
        \end{center}
        \vspace{-3mm}
        {\footnotesize
        \textbf{Componentele TBATS}:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{T}rigonometric: Termeni Fourier pentru sezonalitate
            \item \textbf{B}ox-Cox: Stabilizarea varianței
            \item \textbf{A}RMA: Autocorelația erorilor
            \item \textbf{T}rend: Trend local amortizat
            \item \textbf{S}easonal: Perioade sezoniere multiple
        \end{itemize}
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_quiz2\_tbats\_components}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_quiz2_tbats_components}
\end{frame}

\begin{frame}{Test 3: Termenii Fourier}
    \begin{alertblock}{Întrebare}
        În TBATS, creșterea numărului de armonice Fourier ($K$) pentru un pattern sezonier:
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Îmbunătățește întotdeauna acuratețea prognozei
        \item Permite forme sezoniere mai flexibile (complexe)
        \item Reduce complexitatea modelului
        \item Elimină necesitatea transformării Box-Cox
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 3: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Permite forme sezoniere mai flexibile}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.50\textheight, keepaspectratio]{ch9_quiz3_fourier_harmonics.pdf}
        \end{center}
        \vspace{-3mm}
        {\footnotesize
        \textbf{Compromis}: Mai multe armonice = mai multă flexibilitate dar și mai mulți parametri.
        $$s_t^{(i)} = \sum_{j=1}^{K_i} \left[ a_j^{(i)} \cos\left(\frac{2\pi j t}{m_i}\right) + b_j^{(i)} \sin\left(\frac{2\pi j t}{m_i}\right) \right]$$
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_quiz3\_fourier\_harmonics}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_quiz3_fourier_harmonics}
\end{frame}

\begin{frame}{Test 4: Descompunerea Prophet}
    \begin{alertblock}{Întrebare}
        Prophet descompune o serie de timp în care componente?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Componente AR, MA și sezoniere
        \item Trend, sezonalitate, sărbători și eroare
        \item Medie, varianță și autocorelație
        \item Nivel, pantă și curbură
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 4: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Trend, sezonalitate, sărbători și eroare}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.48\textheight, keepaspectratio]{ch9_quiz4_prophet_decomposition.pdf}
        \end{center}
        \vspace{-3mm}
        {\footnotesize
        \textbf{Modelul Prophet}: $y(t) = g(t) + s(t) + h(t) + \varepsilon_t$
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $g(t)$: Trend (liniar pe porțiuni sau creștere logistică)
            \item $s(t)$: Sezonalitate (serii Fourier)
            \item $h(t)$: Efecte de sărbători
            \item $\varepsilon_t$: Termen de eroare
        \end{itemize}
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_quiz4\_prophet\_decomposition}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_quiz4_prophet_decomposition}
\end{frame}

\begin{frame}{Test 5: Prophet vs TBATS}
    \begin{alertblock}{Întrebare}
        Când ați alege Prophet în locul TBATS?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Când aveți nevoie de selecție automată a modelului
        \item Când aveți sărbători și puncte de schimbare cunoscute de încorporat
        \item Când aveți nevoie de cel mai simplu model
        \item Când datele nu au trend
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 5: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Sărbători și puncte de schimbare cunoscute}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.58\textheight, keepaspectratio]{ch9_quiz5_prophet_vs_tbats.pdf}
        \end{center}
        \vspace{-0.2cm}
        {\footnotesize
        \textbf{Avantaje Prophet}: Integrare ușoară a sărbătorilor, analyst-in-the-loop, gestionează date lipsă, componente interpretabile. \\
        \textbf{Avantaje TBATS}: Selecție automată a modelului, gestionează sezonalitate complexă fără expertiză de domeniu.
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_quiz5\_prophet\_vs\_tbats}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_quiz5_prophet_vs_tbats}
\end{frame}

\begin{frame}{Test 6: Modul de Sezonalitate}
    \begin{alertblock}{Întrebare}
        Pentru date de vânzări retail unde vânzările din decembrie sunt de 3 ori media lunară, ce mod de sezonalitate este mai potrivit în Prophet?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Sezonalitate aditivă
        \item Sezonalitate multiplicativă
        \item Ambele funcționează la fel de bine
        \item Niciunul---folosiți ARIMA în schimb
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 6: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Sezonalitate multiplicativă}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.58\textheight, keepaspectratio]{ch9_quiz6_seasonality_mode.pdf}
        \end{center}
        \vspace{-0.2cm}
        {\footnotesize
        \textbf{Esențial}: Când amplitudinea sezonieră se scalează cu nivelul, folosiți multiplicativ. \\
        \textbf{Aditiv}: $y = g(t) + s(t)$ (efect sezonier constant) \\
        \textbf{Multiplicativ}: $y = g(t) \cdot (1 + s(t))$ (efect sezonier proporțional)
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_additive\_vs\_multiplicative}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_additive_vs_multiplicative}
\end{frame}

\begin{frame}{Test 7: Punctele de Schimbare în Prophet}
    \begin{alertblock}{Întrebare}
        În Prophet, punctele de schimbare (changepoints) permit modelului să:
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Schimbe automat perioada sezonieră
        \item Ajusteze panta trendului în puncte specifice în timp
        \item Comute între modurile aditiv și multiplicativ
        \item Detecteze și elimine valorile aberante
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 7: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Ajustează panta trendului în puncte specifice}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.58\textheight, keepaspectratio]{ch9_quiz7_changepoints.pdf}
        \end{center}
        \vspace{-0.2cm}
        {\footnotesize
        \textbf{Puncte de schimbare}: Permit trend liniar pe porțiuni cu pante diferite.
        $$g(t) = (k + \mathbf{a}(t)^\top \boldsymbol{\delta}) \cdot t + (m + \mathbf{a}(t)^\top \boldsymbol{\gamma})$$
        Prophet detectează automat punctele de schimbare sau le puteți specifica manual.
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_changepoint\_detection}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_changepoint_detection}
\end{frame}

\begin{frame}{Test 8: Selecția Modelului}
    \begin{alertblock}{Întrebare}
        Aveți date zilnice de call center cu doar sezonalitate săptămânală. Ce model este cel mai potrivit?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item TBATS (proiectat pentru sezonalitate multiplă)
        \item Prophet (gestionează bine orice sezonalitate)
        \item SARIMA standard (mai simplu și suficient)
        \item Rețea neuronală LSTM (cea mai flexibilă)
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 8: Răspuns}
    \begin{exampleblock}{Răspuns: C -- SARIMA standard este suficient}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.58\textheight, keepaspectratio]{ch9_quiz8_model_decision.pdf}
        \end{center}
        \vspace{-0.2cm}
        {\footnotesize
        \textbf{Principiul parcimoniei}: Folosiți cel mai simplu model care se potrivește datelor. \\
        Cu doar sezonalitate săptămânală ($m=7$), SARIMA funcționează bine. \\
        Folosiți TBATS/Prophet când \textit{aveți nevoie} de sezonalități multiple sau funcționalități speciale.
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_model\_selection\_guide}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_model_selection_guide}
\end{frame}

\begin{frame}{Test 9: Incertitudinea în Prophet}
    \begin{alertblock}{Întrebare}
        Prophet generează intervale de predicție prin:
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item Presupunând reziduuri normal distribuite
        \item Eșantionând din distribuția posterioară a parametrilor
        \item Folosind reeșantionare bootstrap a erorilor istorice
        \item Aplicând un multiplicator fix la prognozele punctuale
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 9: Răspuns}
    \begin{exampleblock}{Răspuns: B -- Eșantionează din distribuția posterioară}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.50\textheight, keepaspectratio]{ch9_quiz9_prophet_uncertainty.pdf}
        \end{center}
        \vspace{-3mm}
        {\footnotesize
        \textbf{Prophet folosește estimare Bayesiană}: \\
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Estimare MAP pentru prognoze punctuale; MCMC sau simulare pentru intervale de incertitudine
            \item Incertitudine atât din trend (changepoints) cât și din zgomotul observațiilor
        \end{itemize}
        Notă: implicit, Prophet folosește estimare MAP. Intervalele de predicție provin din simularea punctelor de schimbare viitoare ale trendului și adăugarea variabilității reziduale istorice, nu din eșantionare posterioară completă (MCMC este opțional via \texttt{mcmc\_samples > 0}).
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_prophet\_components}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_prophet_components}
\end{frame}

\begin{frame}{Test 10: Aplicație Practică}
    \begin{alertblock}{Întrebare}
        Pentru prognoza consumului orar de energie cu pattern-uri zilnice, săptămânale și anuale plus efecte de sărbători, care abordare este cea mai bună?
    \end{alertblock}

    \vspace{0.3cm}

    \begin{enumerate}[A)]
        \item SARIMA cu $m=24$
        \item TBATS cu trei perioade sezoniere
        \item Prophet cu sărbători personalizate
        \item Fie TBATS fie Prophet, în funcție de importanța sărbătorilor
    \end{enumerate}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Test 10: Răspuns}
    \begin{exampleblock}{Răspuns: D -- TBATS sau Prophet în funcție de necesități}
        \begin{center}
            \includegraphics[width=0.85\textwidth, height=0.50\textheight, keepaspectratio]{ch9_quiz10_energy_example.pdf}
        \end{center}
        \vspace{-3mm}
        {\footnotesize
        \textbf{Ambele pot gestiona sezonalitate multiplă}: \\
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Sărbători cruciale $\Rightarrow$ \textbf{Prophet} (modelare explicită); selecție automată $\Rightarrow$ \textbf{TBATS}
            \item Adesea: Încercați ambele și comparați prin validare încrucișată
        \end{itemize}
        }
    \end{exampleblock}
    \quantlet{TSA\_ch9\_electricity\_demand}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_electricity_demand}
\end{frame}

%=============================================================================
% TRUE/FALSE QUESTIONS
%=============================================================================
\section{Întrebări Adevărat/Fals}

\begin{frame}{Întrebări Adevărat/Fals}
    Determinați dacă fiecare afirmație este Adevărată sau Falsă:

    \vspace{0.3cm}
    \begin{enumerate}
        \item Prophet a fost dezvoltat de Facebook (Meta) pentru prognoza de business.
        \item TBATS poate gestiona cel mult două perioade sezoniere.
        \item În Prophet, trendul implicit este creștere logistică.
        \item Termenii Fourier aproximează sezonalitatea folosind funcții sinus și cosinus.
        \item Prophet necesită date de serii de timp echidistante.
        \item Transformarea Box-Cox din TBATS stabilizează varianța.
    \end{enumerate}

    \vspace{0.3cm}
    \begin{flushright}\textit{Răspunsurile pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Adevărat/Fals: Soluții}
    {\small
    \begin{enumerate}\setlength{\itemsep}{1pt}
        \item Prophet a fost dezvoltat de Facebook (Meta) pentru prognoza de business. \hfill \textcolor{Forest}{\textbf{ADEVĂRAT}}

        {\footnotesize \textcolor{MediumGray}{Lansat în 2017, proiectat pentru prognoză „analyst in the loop" la scară largă.}}

        \item TBATS poate gestiona cel mult două perioade sezoniere. \hfill \textcolor{Crimson}{\textbf{FALS}}

        {\footnotesize \textcolor{MediumGray}{TBATS poate gestiona orice număr de perioade sezoniere (ex. zilnic, săptămânal, anual).}}

        \item În Prophet, trendul implicit este creștere logistică. \hfill \textcolor{Crimson}{\textbf{FALS}}

        {\footnotesize \textcolor{MediumGray}{Implicit este liniar pe porțiuni. Creșterea logistică trebuie specificată explicit.}}

        \item Termenii Fourier aproximează sezonalitatea folosind funcții sinus și cosinus. \hfill \textcolor{Forest}{\textbf{ADEVĂRAT}}

        {\footnotesize \textcolor{MediumGray}{$s(t) = \sum_{k=1}^{K}[a_k \cos(2\pi kt/m) + b_k \sin(2\pi kt/m)]$}}

        \item Prophet necesită date de serii de timp echidistante. \hfill \textcolor{Crimson}{\textbf{FALS}}

        {\footnotesize \textcolor{MediumGray}{Prophet gestionează elegant datele lipsă și timestamp-urile neregulate.}}

        \item Transformarea Box-Cox din TBATS stabilizează varianța. \hfill \textcolor{Forest}{\textbf{ADEVĂRAT}}

        {\footnotesize \textcolor{MediumGray}{$y^{(\lambda)} = (y^\lambda - 1)/\lambda$ pentru $\lambda \neq 0$; $\log(y)$ pentru $\lambda = 0$.}}
    \end{enumerate}
    }
\end{frame}

%=============================================================================
% SECTION 2: PRACTICE PROBLEMS
%=============================================================================
\section{Probleme Practice}

\begin{frame}{Problemă 1: Calculul Termenilor Fourier}
    \begin{block}{Enunț}
        Pentru date zilnice cu sezonalitate săptămânală ($m=7$), doriți să folosiți termeni Fourier cu $K=3$ armonice.

        \vspace{0.2cm}
        Câți parametri adaugă aceasta la model?
    \end{block}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Problemă 1: Soluție}
    \begin{exampleblock}{Soluție: 6 parametri}
        \textbf{Fiecare armonică} necesită 2 parametri (coeficienți sinus și cosinus):
        $$s(t) = \sum_{k=1}^{K} \left[ a_k \cos\left(\frac{2\pi k t}{m}\right) + b_k \sin\left(\frac{2\pi k t}{m}\right) \right]$$

        \vspace{0.2cm}
        Cu $K=3$ armonice:
        \begin{itemize}
            \item $k=1$: $a_1, b_1$ (frecvența fundamentală)
            \item $k=2$: $a_2, b_2$ (prima armonică)
            \item $k=3$: $a_3, b_3$ (a doua armonică)
        \end{itemize}

        \vspace{0.2cm}
        \textbf{Total}: $2 \times K = 2 \times 3 = 6$ parametri

        \vspace{0.2cm}
        \textbf{Notă}: Maximum util $K = \lfloor m/2 \rfloor = 3$ pentru $m=7$.
    \end{exampleblock}
    \quantlet{TSA\_ch9\_fourier\_approximation}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_fourier_approximation}
\end{frame}

\begin{frame}{Problemă 2: Alegerea Modului de Sezonalitate}
    \begin{block}{Enunț}
        Prognozați rezervările lunare la hotel. Datele arată:
        \begin{itemize}
            \item Iulie 2020: 1000 rezervări (sezon de vârf)
            \item Ianuarie 2020: 400 rezervări (extrasezon)
            \item Iulie 2023: 2000 rezervări (sezon de vârf)
            \item Ianuarie 2023: 800 rezervări (extrasezon)
        \end{itemize}

        Ar trebui să folosiți sezonalitate aditivă sau multiplicativă? De ce?
    \end{block}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Problemă 2: Soluție}
    \begin{exampleblock}{Soluție: Sezonalitate multiplicativă}
        \textbf{Analiză}: Verificați dacă amplitudinea sezonieră este proporțională cu nivelul.

        \vspace{0.2cm}
        \begin{tabular}{lccc}
            \toprule
            An & Iulie & Ianuarie & Raport (Iul/Ian) \\
            \midrule
            2020 & 1000 & 400 & 2.5 \\
            2023 & 2000 & 800 & 2.5 \\
            \bottomrule
        \end{tabular}

        \vspace{0.3cm}
        \textbf{Observație cheie}: \textit{Raportul} rămâne constant (2.5), nu diferența!
        \begin{itemize}
            \item Aditiv ar însemna: Iulie întotdeauna +600 față de Ianuarie
            \item Dar 2020: $1000 - 400 = 600$; 2023: $2000 - 800 = 1200$
        \end{itemize}

        \vspace{0.2cm}
        \textbf{Concluzie}: Folosiți multiplicativ: \texttt{seasonality\_mode='multiplicative'}
    \end{exampleblock}
    \quantlet{TSA\_ch9\_additive\_vs\_multiplicative}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_additive_vs_multiplicative}
\end{frame}

\begin{frame}{Problemă 3: Interpretarea Modelului TBATS}
    \begin{block}{Enunț}
        Un model TBATS ajustat pe date orare de electricitate raportează:
        \begin{itemize}
            \item Box-Cox $\lambda = 0.5$
            \item Perioade sezoniere: $m_1 = 24$, $m_2 = 168$
            \item Termeni Fourier: $K_1 = 5$, $K_2 = 3$
        \end{itemize}

        Ce ne spune fiecare componentă despre date?
    \end{block}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Problemă 3: Soluție}
    \begin{exampleblock}{Soluție}
        \textbf{Box-Cox $\lambda = 0.5$}:
        \begin{itemize}
            \item Transformare rădăcină pătrată aplicată
            \item Datele aveau varianță crescătoare cu nivelul
            \item Transformare: $y^{(0.5)} = \sqrt{y}$
        \end{itemize}

        \vspace{0.2cm}
        \textbf{Perioade sezoniere}:
        \begin{itemize}
            \item $m_1 = 24$: Pattern zilnic (24 ore)
            \item $m_2 = 168$: Pattern săptămânal ($7 \times 24 = 168$ ore)
        \end{itemize}

        \vspace{0.2cm}
        \textbf{Termeni Fourier}:
        \begin{itemize}
            \item $K_1 = 5$ pentru zilnic: Pattern intrazilnic complex (5 armonice captează vârfuri, văi)
            \item $K_2 = 3$ pentru săptămânal: Pattern săptămânal mai simplu (zi lucrătoare vs weekend)
        \end{itemize}

        \vspace{0.2cm}
        \textbf{Total parametri sezonieri}: $2(K_1 + K_2) = 2(5+3) = 16$
    \end{exampleblock}
    \quantlet{TSA\_ch9\_tbats\_decomposition}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_tbats_decomposition}
\end{frame}

\begin{frame}{Problemă 4: Efectele Sărbătorilor în Prophet}
    \begin{block}{Enunț}
        Prognozați veniturile zilnice ale unui restaurant. Doriți să adăugați aceste efecte de sărbători în Prophet:
        \begin{itemize}
            \item Ziua Îndrăgostiților (14 Feb) -- creștere majoră
            \item Paște (dată variabilă) -- restaurant închis
            \item Crăciun (25 Dec) -- restaurant închis
        \end{itemize}

        Scrieți codul Python pentru a crea dataframe-ul de sărbători pentru 2024-2025.
    \end{block}

    \vspace{0.5cm}
    \begin{flushright}\textit{Răspunsul pe slide-ul următor...}\end{flushright}
\end{frame}

\begin{frame}{Problemă 4: Soluție}
    \begin{exampleblock}{Soluție}
        {\scriptsize\ttfamily
        import pandas as pd\\
        from prophet import Prophet\\[0.2em]
        holidays = pd.DataFrame(\{\\
        \quad 'holiday': ['valentines', 'paste', 'craciun'],\\
        \quad 'ds': pd.to\_datetime([...]),\\
        \quad 'lower\_window': [0, 0, 0],\\
        \quad 'upper\_window': [0, 0, 0]\\
        \})\\[0.2em]
        model = Prophet(holidays=holidays)\\
        model.fit(df)
        }
        \vspace{0.2cm}
        \textbf{Notă}: Folosiți \texttt{lower\_window=-1, upper\_window=1} pentru a captura efecte pe zile adiacente.
    \end{exampleblock}
    \quantlet{TSA\_ch9\_prophet\_components}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_prophet_components}
\end{frame}

%=============================================================================
% SECTION 3: WORKED EXAMPLES
%=============================================================================
\section{Exemple Rezolvate}

\begin{frame}{Exemplu: Prognoza Vânzărilor Retail cu Prophet}
    {\small
    \begin{block}{Scenariu}
        Date lunare de vânzări retail (2018-2023) cu:
        \begin{itemize}
            \item Vârfuri puternice în decembrie (cumpărături de Crăciun)
            \item Impact COVID-19 în 2020 (ruptură structurală)
            \item Trend crescător în timp
        \end{itemize}
    \end{block}
    \begin{exampleblock}{Configurare Prophet}
        {\scriptsize\ttfamily
        model = Prophet(\\
        \quad seasonality\_mode='multiplicative',\\
        \quad changepoint\_prior\_scale=0.5,\\
        \quad yearly\_seasonality=True)\\
        model.add\_country\_holidays(country\_name='RO')
        }
    \end{exampleblock}
    \begin{alertblock}{Decizie Cheie}
        Sezonalitate multiplicativă: efectul decembrie este proporțional cu nivelul de bază.
    \end{alertblock}
    }
    \quantlet{TSA\_ch9\_retail\_sales}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_retail_sales}
\end{frame}

\begin{frame}{Exemplu: Cererea de Energie cu TBATS}
    {\small
    \begin{block}{Scenariu}
        Cerere orară de electricitate cu:
        \begin{itemize}
            \item Pattern intrazilnic (24 ore)
            \item Pattern săptămânal (168 ore)
            \item Pattern anual (8760 ore)
        \end{itemize}
    \end{block}
    \begin{exampleblock}{TBATS în R}
        {\scriptsize\ttfamily
        library(forecast)\\[0.2em]
        energy\_msts <- msts(energy\_data,\\
        \quad seasonal.periods = c(24, 168, 8760))\\[0.2em]
        fit <- tbats(energy\_msts)\\
        fc <- forecast(fit, h = 168)
        }
    \end{exampleblock}
    \begin{alertblock}{Notă}
        TBATS selectează automat $K$ pentru fiecare perioadă sezonieră prin AIC.
    \end{alertblock}
    }
    \quantlet{TSA\_ch9\_electricity\_demand}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_electricity_demand}
\end{frame}

\begin{frame}{Exemplu: Comparație prin Validare Încrucișată}
    {\footnotesize
    \begin{block}{Obiectiv}
        Comparați Prophet, TBATS și SARIMA pe 2 ani de date zilnice de vânzări.
    \end{block}
    \begin{exampleblock}{Validare Încrucișată Prophet}
        {\scriptsize\ttfamily
        from prophet.diagnostics import cross\_validation\\
        df\_cv = cross\_validation(model, initial='365 days',\\
        \quad period='90 days', horizon='30 days')\\
        metrics = performance\_metrics(df\_cv)
        }
    \end{exampleblock}
    \begin{block}{Rezultate Tipice}
        \begin{center}
        \begin{tabular}{lcc}
            \toprule
            Model & MAPE & Timp de Calcul \\
            \midrule
            SARIMA (doar săptămânal) & 8.5\% & Rapid \\
            TBATS (săptămânal + anual) & 6.2\% & Moderat \\
            Prophet (săptămânal + anual + sărbători) & 5.8\% & Rapid \\
            \bottomrule
        \end{tabular}
        \end{center}
    \end{block}
    }
    \quantlet{TSA\_ch9\_prophet\_vs\_tbats}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_prophet_vs_tbats}
\end{frame}

%=============================================================================
% SECTION 4: DISCUSSION TOPICS
%=============================================================================
\section{Subiecte de Discuție}

\begin{frame}{Discuție: Când să Folosim Care Model?}
    {\small
    \begin{alertblock}{Întrebare Cheie}
        Aveți o nouă sarcină de prognoză. Cum alegeți între SARIMA, TBATS și Prophet?
    \end{alertblock}
    \begin{block}{Cadru de Decizie}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item \textbf{Câte perioade sezoniere?}
                \begin{itemize}
                    \item Una $\Rightarrow$ SARIMA poate fi suficient
                    \item Multiple $\Rightarrow$ TBATS sau Prophet
                \end{itemize}
            \item \textbf{Aveți cunoștințe de domeniu de încorporat?}
                \begin{itemize}
                    \item Sărbători, evenimente, puncte de schimbare $\Rightarrow$ Prophet
                    \item Lăsați datele să vorbească $\Rightarrow$ TBATS
                \end{itemize}
            \item \textbf{Cerințe de interpretabilitate?}
                \begin{itemize}
                    \item Trebuie să explicați componentele $\Rightarrow$ Prophet
                    \item Doar prognoze $\Rightarrow$ Oricare
                \end{itemize}
        \end{enumerate}
    \end{block}
    }
    \quantlet{TSA\_ch9\_model\_selection\_guide}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_model_selection_guide}
\end{frame}

\begin{frame}{Discuție: Supraajustare cu Termeni Fourier}
    {\small
    \begin{alertblock}{Întrebare Cheie}
        Puteți avea prea mulți termeni Fourier? Care sunt simptomele?
    \end{alertblock}
    \vspace{-1mm}
    \begin{block}{Răspuns: Da!}
        \textbf{Simptome de supraajustare}:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Ajustare in-sample excelentă, dar out-of-sample slabă
            \item Sezonalitatea arată „zimțată" sau nerealistă; prognozele oscilează puternic
        \end{itemize}
    \end{block}
    \vspace{-1mm}
    \begin{exampleblock}{Ghiduri}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Maximum $K \leq m/2$ (limita Nyquist); începeți cu $K = 3$--$5$
            \item Folosiți validare încrucișată pentru a selecta $K$
            \item Implicit Prophet: $K=10$ pentru anual, $K=3$ pentru săptămânal
        \end{itemize}
    \end{exampleblock}
    }
    \quantlet{TSA\_ch9\_fourier\_approximation}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_fourier_approximation}
\end{frame}

\begin{frame}{Discuție: Gestionarea Rupturilor Structurale}
    {\small
    \begin{alertblock}{Scenariu}
        Datele istorice includ perioada COVID-19 (2020-2021). Cum gestionați acest lucru când prognozați 2024?
    \end{alertblock}
    \begin{block}{Opțiuni}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item \textbf{Excludeți perioada COVID}: Antrenați doar pe date pre-COVID și post-COVID
            \item \textbf{Folosiți puncte de schimbare}: Lăsați Prophet să detecteze/specificați rupturi
            \item \textbf{Adăugați regresori}: Includeți variabilă indicator COVID
            \item \textbf{Ajustare}: Ajustați manual valorile 2020-2021 la „normal"
        \end{enumerate}
    \end{block}
    \begin{exampleblock}{Abordare Prophet}
        {\footnotesize\ttfamily
        model = Prophet(changepoints=[...])\\
        df['covid'] = (df['ds'] >= '2020-03-15') \& ...\\
        model.add\_regressor('covid')
        }
    \end{exampleblock}
    }
    \quantlet{TSA\_ch9\_changepoint\_detection}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_changepoint_detection}
\end{frame}

%=============================================================================
% EXERCIȚIU CU ASISTENȚĂ AI
%=============================================================================
\section{Exercițiu cu asistență AI}

\begin{frame}{Exercițiu AI: Gândire critică}
    \vspace{-3mm}
    \begin{block}{\footnotesize Prompt de testat în ChatGPT / Claude / Copilot}
        {\footnotesize
        ``Folosește setul de date CO$_2$ din statsmodels (concentrația lunară de CO$_2$ de la Mauna Loa, 1958--2001, aprox.\ 468 observații). Completează valorile lipsă prin interpolare. Folosește Facebook Prophet cu trend liniar și sezonalitate anuală pentru a prognoza următorii 5 ani. Compară cu TBATS. Evaluează cu cross-validation (cutoffs la fiecare 2 ani, orizont 24 luni). Raportează RMSE, MAE și MAPE. Vreau cod Python complet cu grafice.''
        }
    \end{block}
    \vspace{-2mm}
    {\footnotesize
    \textbf{Exercițiu}:
    \begin{enumerate}\setlength{\itemsep}{0pt}
        \item Rulați prompt-ul într-un LLM la alegere și analizați critic răspunsul.
        \item Prophet detectează corect trend-ul crescător neliniar al CO$_2$? Trend liniar e suficient?
        \item Cum specifică sezonalitatea? Anuală cu armonice Fourier sau customizată?
        \item Folosește cross-validation cu cutoffs multiple (performance\_metrics)?
        \item TBATS e mai potrivit pentru această serie cu trend puternic? De ce sau de ce nu?
    \end{enumerate}
    }
    \vspace{-2mm}
    \begin{alertblock}{}
        {\footnotesize \textbf{Atenție}: Codul generat de AI poate rula fără erori și arăta profesional. \textit{Asta nu înseamnă că e corect.}}
    \end{alertblock}
    \quantlet{TSA\_ch9\_prophet\_vs\_tbats}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_prophet_vs_tbats}
\end{frame}

%=============================================================================
% SECTION 5: EXERCISES
%=============================================================================
\section{Exerciții pentru Studiu Individual}

\begin{frame}{Exerciții de Lucru Acasă}
    {\footnotesize
    \begin{enumerate}\setlength{\itemsep}{2pt}
        \item \textbf{Teoretic}: Demonstrați că $K = m/2$ termeni Fourier pot reprezenta orice funcție periodică cu perioada $m$ (pentru $m$ par).

        \item \textbf{Calcul}: Pentru pattern-ul sezonier de mai jos (date zilnice, ciclu săptămânal), determinați numărul minim de armonice Fourier necesare:
            \begin{center}
            Lun: 100, Mar: 110, Mie: 115, Joi: 110, Vin: 120, Sâm: 80, Dum: 65
            \end{center}

        \item \textbf{Aplicat}: Descărcați date orare de cerere de electricitate dintr-o sursă publică:
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Ajustați atât TBATS (în R) cât și Prophet (în Python)
                \item Comparați acuratețea prognozei folosind RMSE și MAPE
                \item Vizualizați descompunerile componentelor
            \end{itemize}

        \item \textbf{Gândire Critică}: De ce ar putea Prophet să performeze slab pe date financiare de înaltă frecvență (ex. prețuri de acțiuni minut cu minut)?
    \end{enumerate}
    }
    \quantlet{TSA\_ch9\_tbats\_decomposition}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_tbats_decomposition}
\end{frame}

\begin{frame}{Indicii pentru Soluții}
    {\footnotesize
    \begin{block}{Indicii}
        \begin{enumerate}\setlength{\itemsep}{1pt}
            \item Prin teorema Fourier, orice funcție periodică poate fi reprezentată ca sumă de sinusuri și cosinusuri. Cu perioada $m$, frecvențele sunt $k/m$ pentru $k = 1, \ldots, m/2$.

            \item Pattern-ul are:
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Un vârf (Vineri) și o vale (Duminică)
                    \item Tranziții destul de netede
                    \item $K=2$ sau $K=3$ probabil suficient (încercați și comparați)
                \end{itemize}

            \item Pentru date de electricitate:
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Includeți pattern-uri zilnice (24h) și săptămânale (168h)
                    \item Adăugați sărbătorile pentru regiunea dumneavoastră în Prophet
                    \item Așteptați-vă la MAPE în jur de 3-5\% pentru prognoze orare
                \end{itemize}

            \item Probleme cu datele financiare:
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Fără sezonalitate clară (eficiența pieței)
                    \item Raport zgomot-semnal ridicat
                    \item Prophet proiectat pentru date „de business" cu trenduri și sezoane
                \end{itemize}
        \end{enumerate}
    \end{block}
    }
    \quantlet{TSA\_ch9\_fourier\_approximation}{https://github.com/QuantLet/TSA/tree/main/TSA_ch9/TSA_ch9_fourier_approximation}
\end{frame}

%=============================================================================
% SUMMARY
%=============================================================================
\begin{frame}{Concluzii Cheie din Acest Seminar}
    {\footnotesize
    \begin{block}{Modele pentru Sezonalitate Multiplă}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item \textbf{TBATS}: Automat, bazat pe Fourier, gestionează orice număr de perioade sezoniere
            \item \textbf{Prophet}: Prietenos cu analistul, gestionare explicită a sărbătorilor/evenimentelor, interpretabil
            \item \textbf{Folosiți SARIMA} când există doar o perioadă sezonieră
        \end{enumerate}
    \end{block}
    \begin{block}{Decizii Cheie}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Modul de sezonalitate}: Aditiv (amplitudine constantă) vs Multiplicativ (proporțional)
            \item \textbf{Termeni Fourier}: Mai mulți = flexibil dar risc de supraajustare; folosiți CV pentru selecție
            \item \textbf{Puncte de schimbare}: Permit trendului să se adapteze la rupturi structurale
        \end{itemize}
    \end{block}
    \begin{alertblock}{Rețineți}
        \textbf{Prophet}: Excelent când aveți cunoștințe de domeniu de încorporat \\
        \textbf{TBATS}: Excelent pentru modelare automată a sezonalității complexe
    \end{alertblock}
    }
\end{frame}

%=============================================================================
% THANK YOU SLIDE
%=============================================================================
\begin{frame}[plain]
    \begin{tikzpicture}[remember picture, overlay]
        \fill[IDAred] (current page.north west) rectangle ([yshift=-0.15cm]current page.north east);
    \end{tikzpicture}
    \vfill
    \begin{center}
        {\Huge\textbf{\textcolor{MainBlue}{Vă mulțumesc!}}}\\[1cm]
        {\Large Întrebări?}\\[0.5cm]
        {\large\texttt{danpele@ase.ro}}
    \end{center}
    \vfill
    \begin{tikzpicture}[remember picture, overlay]
        \fill[IDAred] (current page.south west) rectangle ([yshift=0.15cm]current page.south east);
    \end{tikzpicture}
\end{frame}

\end{document}
