% Chapter 4: SARIMA Models
% Harvard-quality academic presentation
% Bachelor's program, Bucharest University of Economic Studies

\documentclass[9pt, aspectratio=169, t]{beamer}
\input{preamble}
\subtitle{Chapter 4: SARIMA Models}

\begin{document}

% Title page (no header/footer)
{
\setbeamertemplate{headline}{}
\setbeamertemplate{footline}{}
\begin{frame}
    \titlepage
\end{frame}
}

%=============================================================================
% LEARNING OBJECTIVES
%=============================================================================
\begin{frame}{Learning Objectives}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{By the end of this chapter, you will be able to:}
    \begin{enumerate}\setlength{\itemsep}{0pt}
        \item[\textcolor{MainBlue}{\textbf{1.}}] \textbf{Identify} seasonal patterns in time series data
        \item[\textcolor{MainBlue}{\textbf{2.}}] \textbf{Apply} seasonal differencing to remove seasonal unit roots
        \item[\textcolor{MainBlue}{\textbf{3.}}] \textbf{Build} and estimate SARIMA models with seasonal components
        \item[\textcolor{MainBlue}{\textbf{4.}}] \textbf{Interpret} seasonal ACF/PACF patterns for model identification
        \item[\textcolor{MainBlue}{\textbf{5.}}] \textbf{Evaluate} forecasts using rolling window methods for seasonal data
        \item[\textcolor{MainBlue}{\textbf{6.}}] \textbf{Apply} the complete methodology on real data (airline passengers)
    \end{enumerate}
    \end{block}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% TABLE OF CONTENTS
%=============================================================================
\begin{frame}{Outline}
    \setbeamertemplate{section in toc}{\color{MainBlue}$\boxdot$~\inserttocsection}
    \tableofcontents
\end{frame}

%=============================================================================
% MOTIVATION
%=============================================================================
\section{Motivation}

\begin{frame}{Why SARIMA? Seasonality Is Everywhere}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.57\textheight, keepaspectratio]{ch4_motivation_seasonal.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Retail sales exhibit clear \textbf{annual patterns}: December peaks, January troughs
        \item Standard ARIMA models cannot capture these \textbf{repeating seasonal cycles}
        \item Ignoring seasonality leads to systematic forecast errors
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_motivation\_seasonal}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_motivation_seasonal}
\end{frame}

\begin{frame}{Understanding Seasonal Components}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.57\textheight, keepaspectratio]{ch4_motivation_decomposition.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Seasonal time series = \textbf{Trend} + \textbf{Seasonal Pattern} + \textbf{Residuals}
        \item Decomposition helps visualize each component separately
        \item SARIMA models capture both trend dynamics and seasonal behavior
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_motivation\_decomposition}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_motivation_decomposition}
\end{frame}

\begin{frame}{Real-World Application: Monthly Patterns}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.57\textheight, keepaspectratio]{ch4_motivation_monthly.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Energy demand shows strong \textbf{monthly seasonality} (heating/cooling cycles)
        \item Pattern repeats predictably each year with slight variations
        \item Utility companies use SARIMA forecasts for capacity planning
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_motivation\_monthly}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_motivation_monthly}
\end{frame}

\begin{frame}{Why Do We Need SARIMA?}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.59\textheight, keepaspectratio]{ch4_motivation_why_sarima.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item \textbf{Left}: Seasonal ACF shows spikes at lags 12, 24, 36... (annual pattern)
        \item \textbf{Right}: ARIMA residuals still show seasonal autocorrelation $\Rightarrow$ model is incomplete
        \item SARIMA adds \textbf{seasonal AR and MA terms} to capture these patterns
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_motivation\_why\_sarima}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_motivation_why_sarima}
\end{frame}


%=============================================================================
% SECTION 1: SEASONALITY IN TIME SERIES
%=============================================================================
\section{Seasonality in Time Series}

\begin{frame}{What is Seasonality?}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{defn}[Seasonality]
            A time series exhibits \textbf{seasonality} when it shows regular, periodic fluctuations that repeat over a fixed period $s$ (the seasonal period).
        \end{defn}

        \vspace{0.0cm}

        \begin{exampleblock}{Common Seasonal Periods}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Monthly data: $s = 12$ (annual cycle)
                \item Quarterly data: $s = 4$ (annual cycle)
                \item Weekly data: $s = 52$ (annual) or $s = 7$ (weekly pattern)
                \item Daily data: $s = 7$ (weekly pattern)
            \end{itemize}
        \end{exampleblock}
    }
\end{frame}

\begin{frame}{What is Seasonality?}
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.78\textheight, keepaspectratio]{ch4_def_seasonality.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_seasonality}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_seasonality}
\end{frame}

\begin{frame}{Example: Airline Passengers Data}
    \begin{cminipage}{0.95\textwidth}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.48\textheight, keepaspectratio]{ch4_airline_data.pdf}
    \end{center}
    \vspace{-0.4cm}
    {\scriptsize
    \begin{exampleblock}{}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item Monthly international airline passengers (1949--1960)
        \item Clear \textbf{upward trend} and \textbf{growing seasonal amplitude}
        \item Summer peaks reflect vacation travel patterns
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_airline\_data}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_airline_data}
\end{frame}

\begin{frame}{Examples of Seasonal Data}
	{\small
		\begin{cminipage}{0.95\textwidth}
			\begin{columns}[T]
				\begin{column}{0.48\textwidth}
					\begin{block}{Economic Series}
						\begin{itemize}\setlength{\itemsep}{0pt}
							\item Retail sales (holiday peaks)
							\item Tourism (summer/winter)
							\item Agricultural production
							\item Energy consumption
							\item Employment (hiring cycles)
						\end{itemize}
					\end{block}
				\end{column}
				\begin{column}{0.48\textwidth}
					\begin{block}{Other Domains}
						\begin{itemize}\setlength{\itemsep}{0pt}
							\item Weather/temperature
							\item Website traffic
							\item Hospital admissions
							\item Transportation usage
							\item Electricity demand
						\end{itemize}
					\end{block}
				\end{column}
			\end{columns}
		\end{cminipage}
	}
	\begin{alertblock}{Why It Matters}
		Ignoring seasonality leads to biased forecasts and invalid inference!
	\end{alertblock}
\end{frame}

\begin{frame}{Visualizing Seasonal Patterns}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.56\textheight, keepaspectratio]{ch4_seasonal_boxplot.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Box plot reveals consistent seasonal pattern across years
        \item July--August: highest passenger counts (summer travel)
        \item November--February: lowest counts (winter months)
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_seasonal\_boxplot}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_seasonal_boxplot}
\end{frame}

\begin{frame}{Deterministic vs Stochastic Seasonality}
    \vspace{-0.2cm}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{columns}[T]
        \begin{column}{0.48\textwidth}
            \begin{block}{Deterministic Seasonality}
                \begin{itemize}\setlength{\itemsep}{1pt}
                    \item \textbf{Fixed pattern}: $Y_t = \sum_{j=1}^{s} \gamma_j D_{jt} + \varepsilon_t$
                    \begin{itemize}\setlength{\itemsep}{0pt}
                        \item $D_{jt}$ are seasonal dummies
                    \end{itemize}
                    \item \textbf{Note:} either omit one dummy variable and include a constant, or impose $\sum \gamma_j = 0$, to avoid perfect collinearity
                    \item Pattern constant over time
                    \item Same amplitude every year
                    \item Removed by regression on dummies
                    \item ACF: sharp cutoff at seasonal lags
                    \item \textbf{Example:} University enrollment peaks every September by the same amount
                \end{itemize}
            \end{block}
        \end{column}
        \begin{column}{0.48\textwidth}
            \begin{block}{Stochastic Seasonality}
                \begin{itemize}\setlength{\itemsep}{1pt}
                    \item \textbf{Evolving pattern}: $\Delta_s Y_t = Y_t - Y_{t-s}$
                    \begin{itemize}\setlength{\itemsep}{0pt}
                        \item Exhibits dependence structure
                    \end{itemize}
                    \item Pattern evolves over time
                    \item Amplitude may grow or shrink
                    \item Requires seasonal differencing
                    \item ACF: slow decay at seasonal lags
                    \item \textbf{Example:} Retail sales peaks grow larger each December
                \end{itemize}
            \end{block}
        \end{column}
    \end{columns}
    \end{cminipage}
    }

    \vspace{0.1cm}

    \begin{alertblock}{How to decide?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Slow ACF decay at lags $s, 2s, 3s, \ldots$ $\Rightarrow$ stochastic (use $\Delta_s$)
            \item Sharp cutoff $\Rightarrow$ deterministic (use dummies)
            \item Use HEGY or Canova-Hansen tests to confirm
        \end{itemize}
    \end{alertblock}
\end{frame}

\begin{frame}{Additive vs Multiplicative Seasonality}
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.78\textheight, keepaspectratio]{additive_vs_multiplicative.pdf}
    \end{center}
\end{frame}

\begin{frame}{Additive vs Multiplicative Seasonality}
    \begin{cminipage}{0.95\textwidth}
    {\scriptsize
    \begin{columns}[T]
        \column{0.48\textwidth}
        \begin{block}{Additive: $Y_t = T_t + S_t + \varepsilon_t$}
            \vspace{-2pt}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Seasonal amplitude \textbf{constant}
                \item No transformation needed
                \item Ex: temperatures, university enrollment
            \end{itemize}
            \vspace{-2pt}
        \end{block}
        \column{0.48\textwidth}
        \begin{block}{Multiplicative: $Y_t = T_t \cdot S_t \cdot \varepsilon_t$}
            \vspace{-2pt}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Amplitude \textbf{grows with level}
                \item Requires log transform (Box-Cox)
                \item Ex: Airline, retail sales, GDP
            \end{itemize}
            \vspace{-2pt}
        \end{block}
    \end{columns}
    }
    \vspace{-0.1cm}
    {\footnotesize
    \begin{alertblock}{First practical decision}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Amplitude grows with the trend? $\Rightarrow$ multiplicative $\Rightarrow$ apply log/Box-Cox \textit{before} differencing
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{ACF Reveals Seasonal Structure}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.58\textheight, keepaspectratio]{ch4_acf_seasonality.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item \textbf{Slow decay} at all lags indicates non-stationarity (trend)
        \item \textbf{Spikes at lags 12, 24, 36} confirm seasonal pattern ($s=12$)
        \item ACF at seasonal lags: slow decay $\Rightarrow$ needs seasonal differencing
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_acf\_seasonality}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_acf_seasonality}
\end{frame}

\begin{frame}{Detecting Seasonality}
    \vspace{-0.2cm}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Visual Methods}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Time series plot -- look for repeating patterns
            \item Seasonal subseries plot -- compare same seasons across years
            \item ACF plot -- spikes at seasonal lags ($s, 2s, 3s, \ldots$)
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{block}{Statistical Tests}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Seasonal unit root tests (HEGY, Canova-Hansen, OCSB\footnote{\scriptsize Osborn-Chui-Smith-Birchenhall --- the default test in \texttt{auto\_arima}})
            \item F-test for seasonal dummy variables
            \item Kruskal-Wallis test (non-parametric)
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{exampleblock}{ACF Signature}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Strong seasonality: ACF shows significant spikes at lags $s, 2s, 3s, \ldots$
        \end{itemize}
    \end{exampleblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{F-Test for Seasonal Dummy Variables: Intuition}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{block}{What does this test do?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Goal}: test whether mean values differ significantly across seasons
            \item \textbf{Logic}: if the mean in January $\neq$ February $\neq$ \ldots $\neq$ December $\Rightarrow$ seasonality
            \item \textbf{Method}: compare a model WITH seasonal dummy variables vs.\ a model WITHOUT
        \end{itemize}
    \end{block}

    \begin{block}{Models compared}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Restricted}: $Y_t = \alpha + \varepsilon_t$ \quad \textbf{Unrestricted}: $Y_t = \alpha + \sum_{j=1}^{s-1} \gamma_j D_{jt} + \varepsilon_t$
            \item where $D_{jt} = 1$ if observation $t$ is in season $j$, 0 otherwise
        \end{itemize}
    \end{block}

    \begin{alertblock}{Key idea}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item If adding seasonal dummy variables \textbf{significantly reduces} prediction errors, then seasonality is present
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{F-Test for Seasonal Dummy Variables: Formula and Example}
    \begin{cminipage}{0.95\textwidth}
    {\small
    \begin{block}{F-statistic formula}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Formula}: $F = \frac{(SSR_R - SSR_U)/(s-1)}{SSR_U/(n-s)} \sim F_{s-1, n-s}$
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item \textbf{$SSR_R$}: sum of squared residuals from the restricted model (no dummies)
                \item \textbf{$SSR_U$}: sum of squared residuals from the unrestricted model (with dummies)
                \item \textbf{$s-1$}: number of restrictions (monthly: 11, quarterly: 3)
            \end{itemize}
        \end{itemize}
    \end{block}

    \begin{exampleblock}{Numerical example (Monthly data, n=120)}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $SSR_R = 15000$, $SSR_U = 8500$, $s = 12$
            \item $F = \frac{(15000 - 8500)/11}{8500/108} = \frac{590.9}{78.7} = 7.51$
            \item Critical value $F_{0.05, 11, 108} \approx 1.87$. Since $7.51 > 1.87$: \textbf{Reject $H_0$} $\Rightarrow$ Seasonality present!
        \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Kruskal-Wallis Test: Intuition}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \begin{block}{What does this test do?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Non-parametric test}: checks whether observations from different seasons come from the same distribution (no distributional assumptions needed)
            \item \textbf{Mechanism}: ranks all observations 1 to $N$, then checks whether ranks are uniformly distributed across seasons
            \item \textbf{Conclusion}: if one season consistently has higher/lower ranks $\Rightarrow$ seasonality (e.g., summer always has high ranks $\Rightarrow$ seasonal energy consumption)
        \end{itemize}
    \end{block}
    \vspace{-1mm}
    \begin{exampleblock}{Why use it instead of the F-test?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{No normality assumption} -- works with any distribution; ideal for heavy-tailed or skewed data
            \item \textbf{Robust to outliers} -- ranks bound the influence of any single observation
        \end{itemize}
    \end{exampleblock}
    \vspace{-1mm}
    \begin{alertblock}{Limitation}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Less powerful than the F-test when data ARE normally distributed
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Kruskal-Wallis Test: Formula and Example}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\scriptsize
    \begin{block}{Test statistic}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $H = \frac{12}{N(N+1)} \sum_{j=1}^{s} \frac{R_j^2}{n_j} - 3(N+1)$ \quad where $N$ = total obs., $n_j$ = obs.\ in season $j$, $R_j$ = rank sum
        \end{itemize}
    \end{block}
    \vspace{-1mm}
    \begin{exampleblock}{Example: Quarterly sales (n=20, s=4)}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Data ranked 1--20. Rank sums: Q1: $R_1\!=\!15$, Q2: $R_2\!=\!35$, Q3: $R_3\!=\!70$, Q4: $R_4\!=\!90$
            \item $H = \frac{12}{20 \times 21}\!\left(\frac{15^2}{5} + \frac{35^2}{5} + \frac{70^2}{5} + \frac{90^2}{5}\right) - 3(21) = 19.57$
            \item Critical value $\chi^2_{0.05, 3} = 7.81$. Since $19.57 > 7.81$: \textbf{Reject $H_0$} $\Rightarrow$ Seasonality!
        \end{itemize}
    \end{exampleblock}
    \vspace{-1mm}
    \begin{alertblock}{In Python}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Implementation}: \texttt{scipy.stats.kruskal(q1, q2, q3, q4)}
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{HEGY Test: What Problem Does It Solve?}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\scriptsize
    \begin{block}{Key question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Problem}: given a seasonal series, we need to determine the type of differencing (wrong choice $\Rightarrow$ over- or under-differencing)
            \item \textbf{Regular differencing} $(1-L)$? $\Rightarrow$ set $d=1$; \textbf{Seasonal differencing} $(1-L^s)$? $\Rightarrow$ set $D=1$
            \item \textbf{HEGY} (Hylleberg, Engle, Granger, Yoo, 1990): tests for both types of unit roots simultaneously!
        \end{itemize}
    \end{block}
    \vspace{-2mm}
    \begin{exampleblock}{Why not just use ADF?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{ADF}: tests only for a regular unit root at frequency zero --- completely ignores seasonal components
            \item \textbf{Limitation}: seasonal data may have unit roots at seasonal frequencies that ADF misses!
        \end{itemize}
    \end{exampleblock}
    \vspace{-2mm}
    \begin{alertblock}{HEGY tests multiple frequencies}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Quarterly}: tests at 0, $\pi$, $\pm\pi/2$ (3 freq.\ $\Rightarrow$ one regular + two seasonal roots)
            \item \textbf{Monthly}: tests at 0, $\pi$, $\pm\pi/6$, $\pm\pi/3$, $\pm\pi/2$, $\pm 2\pi/3$, $\pm 5\pi/6$ (6 freq.\ $\Rightarrow$ one regular + five seasonal roots)
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{HEGY Test: Auxiliary Regression (Quarterly)}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\scriptsize
    \begin{block}{HEGY auxiliary regression}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Quarterly data} ($s=4$): $\Delta_4 y_t = \pi_1 z_{1,t-1} + \pi_2 z_{2,t-1} + \pi_3 z_{3,t-2} + \pi_4 z_{4,t-2} + \sum_{j=1}^{k} \phi_j \Delta_4 y_{t-j} + \varepsilon_t$
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Lags $k$ chosen by AIC/BIC to eliminate residual autocorrelation
                \end{itemize}
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{block}{Transformed variables}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{$z_{1t}$}: $(1+L+L^2+L^3)y_t$ --- captures the zero-frequency component (trend)
            \item \textbf{$z_{2t}$}: $-(1-L+L^2-L^3)y_t$ --- captures the frequency-$\pi$ component (semi-annual)
            \item \textbf{$z_{3t}$, $z_{4t}$}: capture the frequency $\pm\pi/2$ components (annual cycle)
        \end{itemize}
    \end{block}
    \vspace{-1mm}
    \begin{alertblock}{Hypotheses}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{$H_0: \pi_1=0$}: unit root at frequency 0 $\Rightarrow$ requires $d=1$
            \item \textbf{$H_0: \pi_2=0$}: unit root at frequency $\pi$ $\Rightarrow$ requires $D=1$
            \item \textbf{$H_0: \pi_3=\pi_4=0$}: unit root at frequency $\pm\pi/2$ $\Rightarrow$ requires $D=1$
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{HEGY Test: Decision Rules with Examples}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \begin{block}{HEGY critical values (5\%, n=100, with constant)}
        \begin{center}
        \begin{tabular}{lccc}
            \toprule
            Test & Statistic & Critical value & If NOT rejected\ldots \\
            \midrule
            $t_1$ ($\pi_1=0$) & t-stat & $-2.88$ & Requires $d=1$ \\
            $t_2$ ($\pi_2=0$) & t-stat & $-2.88$ & Requires $D=1$ \\
            $F_{34}$ ($\pi_3=\pi_4=0$) & F-stat & $6.57$ & Requires $D=1$ \\
            \bottomrule
        \end{tabular}
        \end{center}
    \end{block}

    \begin{exampleblock}{Example: Quarterly GDP}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{HEGY results}: $t_1 = -1.52$, $t_2 = -4.21$, $F_{34} = 2.15$
            \item $t_1 = -1.52 > -2.88$: Cannot reject $\Rightarrow$ \textbf{requires $d=1$}
            \item $t_2 = -4.21 < -2.88$: Reject $\Rightarrow$ no unit root at $\pi$
            \item $F_{34} = 2.15 < 6.57$: Cannot reject $\Rightarrow$ \textbf{requires $D=1$}
            \item \textbf{Conclusion}: Use SARIMA with $d=1, D=1$
        \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Canova-Hansen Test: The Opposite of HEGY}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{block}{HEGY vs Canova-Hansen: Different null hypotheses!}
        \begin{center}
        \begin{tabular}{lcc}
            \toprule
            & \textbf{HEGY} & \textbf{Canova-Hansen} \\
            \midrule
            $H_0$ & Seasonal unit root & \textbf{No} seasonal unit root \\
            $H_1$ & No seasonal unit root & Seasonal unit root \\
            \midrule
            Reject $H_0$ & Use seasonal dummies & Use differencing $(1-L^s)$ \\
            Do not reject & Use differencing $(1-L^s)$ & Use seasonal dummies \\
            \bottomrule
        \end{tabular}
        \end{center}
    \end{block}

    \begin{alertblock}{Why does it matter?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item HEGY: ``Prove there is NO unit root'' (conservative towards differencing)
            \item CH: ``Prove there IS a unit root'' (conservative towards dummies)
            \item Use \textbf{both} tests for robust conclusions!
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Canova-Hansen Test: Formula}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{block}{Testing procedure}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Step 1}: Regress $y_t$ on seasonal dummies: $y_t = \sum_{j=1}^{s} \gamma_j D_{jt} + u_t$
            \item \textbf{Step 2}: Compute partial sums at seasonal frequency $\lambda_i$:
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item $S_{it}^{(c)} = \sum_{j=1}^{t} \hat{u}_j \cos(\lambda_i j)$, \; $S_{it}^{(s)} = \sum_{j=1}^{t} \hat{u}_j \sin(\lambda_i j)$
            \end{itemize}
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{block}{LM test statistic}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $LM_i = \frac{1}{T^2 \hat{\omega}_i} \left[ \sum_{t=1}^{T} (S_{it}^{(c)})^2 + \sum_{t=1}^{T} (S_{it}^{(s)})^2 \right]$
            \item where $\hat{\omega}_i$ = consistent estimator of the spectral density at frequency $\lambda_i$
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{alertblock}{Decision}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Rule}: reject $H_0$ (stationarity) if $LM > $ critical value $\Rightarrow$ seasonal differencing is needed
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Summary: Choosing the Right Seasonality Test}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{center}
    \begin{tabular}{p{2cm}p{2.5cm}p{2.5cm}p{3cm}}
        \toprule
        \textbf{Test} & \textbf{$H_0$} & \textbf{If rejected} & \textbf{Best for} \\
        \midrule
        F-test & No seasonality & Seasonality exists & Normal data \\
        Kruskal-Wallis & No difference across seasons & Seasonality exists & Non-normal, outliers \\
        HEGY & Unit root exists & Use dummies & Determining $d$, $D$ \\
        Canova-Hansen & No unit root & Use $(1-L^s)$ & Confirming stability \\
        \bottomrule
    \end{tabular}
    \end{center}

    \vspace{0.1cm}

    \begin{alertblock}{Key idea}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{F-test / Kruskal-Wallis}: ``\textit{Does seasonality exist?}''
            \item \textbf{HEGY / Canova-Hansen}: ``\textit{What type?}'' (deterministic vs stochastic)
        \end{itemize}
    \end{alertblock}
    }
    \end{cminipage}
\end{frame}

%=============================================================================
% BOX-COX TRANSFORMATION
%=============================================================================

\begin{frame}{Box-Cox Transformation: Variance Stabilization}
    \vspace{-0.3cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \vspace{-1mm}
    \begin{block}{Box-Cox Family of Transformations}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Formula}: $Y_t^{(\lambda)} = (Y_t^\lambda - 1)/\lambda$ if $\lambda \neq 0$; $\;\ln(Y_t)$ if $\lambda = 0$
            \item \textbf{Special cases}: $\lambda\!=\!1$ (none), $\lambda\!=\!0$ (log), $\lambda\!=\!0.5$ ($\sqrt{\cdot}$). $\lambda < 1$ compresses large values; $\lambda > 1$ amplifies
        \end{itemize}
    \end{block}
    \vspace{-2mm}
    \begin{exampleblock}{Automatic Selection of $\lambda$}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Profile likelihood}: maximizes log-likelihood as a function of $\lambda$ (most common; provides CI)
            \item \textbf{Guerrero (1993)}: minimizes CV of seasonal sub-series (preferred for varying amplitude)
            \item \textbf{Python}: \texttt{boxcox(y)} from \texttt{scipy.stats} or \texttt{BoxCox.lambda\_(y)} in R
        \end{itemize}
    \end{exampleblock}
    \vspace{-2mm}
    \begin{alertblock}{Why not just logarithm?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Log ($\lambda\!=\!0$) assumes variance $\propto$ level --- not always the case (e.g., may need $\lambda = 0.3$)
            \item Box-Cox chooses the optimal transformation based on data, not assumptions
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{Box-Cox on the Airline Data: Complete Example}
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.78\textheight, keepaspectratio]{ch4_boxcox_airline.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_boxcox\_airline}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_boxcox_airline}
\end{frame}

\begin{frame}{Box-Cox on the Airline Data: Complete Example}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\scriptsize
    \begin{columns}[T]
        \column{0.48\textwidth}
        \begin{exampleblock}{Result for Airline Passengers}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item $\hat{\lambda} = 0.148 \approx 0$ $\Rightarrow$ log is nearly optimal
                \item Standard deviation per year: from increasing (original) to stable (log)
            \end{itemize}
        \end{exampleblock}
        \column{0.48\textwidth}
        \begin{alertblock}{Bias Correction in Back-Transformation}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item On log scale: $\hat{y}_{T+h}$ is the \textbf{median}, not the mean
                \item Correction: $\hat{Y}_{T+h} = \exp\!\left(\hat{y}_{T+h} + \frac{\sigma^2_h}{2}\right)$
                \item Without correction: systematically under-estimated forecasts!
            \end{itemize}
        \end{alertblock}
    \end{columns}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{STL Decomposition: Modern Alternatives}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{STL: Seasonal-Trend Decomposition using Loess (Cleveland et al., 1990)}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Advantages}: time-varying seasonality, robust to outliers, any period $s$
            \item \textbf{Algorithm}: iterative locally weighted regression (loess)
        \end{itemize}
        \vspace{-2pt}
    \end{block}

    \begin{exampleblock}{Key Parameters}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Seasonal window} (\texttt{seasonal}): controls how quickly seasonality changes
            \item \textbf{Trend window} (\texttt{trend}): smoothing of the trend component
            \item \textbf{Robustness} (\texttt{robust=True}): reduces influence of outliers
        \end{itemize}
        \vspace{-2pt}
    \end{exampleblock}

    \begin{alertblock}{Practical Usage}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item STL for exploration and preprocessing; SARIMA for modeling and forecasting
            \item Python: \texttt{STL(y, period=12).fit()} from \texttt{statsmodels}
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SECTION 2: SEASONAL DIFFERENCING
%=============================================================================
\section{Seasonal Differencing}

\begin{frame}{Seasonal Difference: Visual Illustration}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.62\textheight, keepaspectratio]{ch4_def_seasonal_diff.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item \textbf{Left}: Original series with clear seasonal pattern
        \item \textbf{Right}: After $\Delta_{12} = (1-L^{12})$, the seasonal pattern is removed
            \begin{itemize}
                \item Year-over-year comparison eliminates seasonal effects
            \end{itemize}
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_seasonal\_diff}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_seasonal_diff}
\end{frame}

\begin{frame}{The Seasonal Difference Operator}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{defn}[Seasonal Difference]
            The \textbf{seasonal difference operator} $\Delta_s$ is defined as:
            $$\Delta_s Y_t = (1 - L^s) Y_t = Y_t - Y_{t-s}$$
            where $L^s Y_t = Y_{t-s}$ is the seasonal lag operator.
        \end{defn}

        \vspace{0.0cm}

        \begin{exampleblock}{Examples}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Monthly data ($s=12$): $\Delta_{12} Y_t = Y_t - Y_{t-12}$

                Compares each month to the same month last year
                \item Quarterly data ($s=4$): $\Delta_4 Y_t = Y_t - Y_{t-4}$

                Compares each quarter to the same quarter last year
            \end{itemize}
        \end{exampleblock}
    }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.18\textheight, keepaspectratio]{ch4_def_seasonal_diff.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_seasonal\_diff}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_seasonal_diff}
\end{frame}

\begin{frame}{Proof: Seasonal Differencing Removes Deterministic Seasonality}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \textbf{Claim:} If $Y_t = \mu_t + \varepsilon_t$ where $\mu_t = \mu_{t-s}$ (periodic mean), then $\Delta_s Y_t$ removes the seasonal mean.
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item The condition $\mu_t = \mu_{t-s}$ means the mean repeats exactly every $s$ periods
    \end{itemize}

    \vspace{0.05cm}
    \textbf{Proof:} Let $Y_t = \mu_t + \varepsilon_t$ where $\mu_t$ has period $s$. Apply seasonal difference:
    \vspace{-0.1cm}
    \begin{align*}
    \Delta_s Y_t &= Y_t - Y_{t-s} = (\mu_t + \varepsilon_t) - (\mu_{t-s} + \varepsilon_{t-s}) \\
    &= \mu_t - \mu_{t-s} + \varepsilon_t - \varepsilon_{t-s} \\
    &= 0 + \varepsilon_t - \varepsilon_{t-s} \quad \text{(since } \mu_t = \mu_{t-s}\text{)}
    \end{align*}
    \vspace{-0.2cm}

    \textbf{Properties of $\Delta_s Y_t = \varepsilon_t - \varepsilon_{t-s}$:}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item $\E[\Delta_s Y_t] = 0$ (constant mean); $\Var(\Delta_s Y_t) = 2\sigma^2$ (constant variance)
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Both properties are required for second-order stationarity
            \end{itemize}
        \item Autocovariance: $\gamma(s) = -\sigma^2$, $\gamma(k) = 0$ for $k \neq 0, s$
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item ACF shows a single spike at lag $s$, then zero
            \end{itemize}
    \end{itemize}

    \begin{exampleblock}{Result}
        Seasonal differencing transforms periodic seasonal pattern into MA(1) at seasonal lag.
    \end{exampleblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Effect of Differencing Operations}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Regular differencing removes trend but seasonal pattern remains
        \item Seasonal differencing removes seasonality but trend pattern remains
        \item \textbf{Both differences} needed to achieve stationarity
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_differencing_effect.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_differencing\_effect}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_differencing_effect}
\end{frame}

\begin{frame}{Combining Regular and Seasonal Differencing}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Full Differencing}
        For series with both trend and seasonality:
        $$\Delta \Delta_s Y_t = (1-L)(1-L^s) Y_t$$
    \end{block}

    \vspace{0.1cm}

    \begin{exampleblock}{Expansion}
        $(1-L)(1-L^s) Y_t = Y_t - Y_{t-1} - Y_{t-s} + Y_{t-s-1}$. For monthly: $\Delta \Delta_{12} Y_t = Y_t - Y_{t-1} - Y_{t-12} + Y_{t-13}$
    \end{exampleblock}

    \begin{alertblock}{Order of Differencing}
        $d$: regular differences (trend removal); $D$: seasonal differences (seasonal trend removal)
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{ACF Before and After Differencing}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Original ACF: slow decay indicates non-stationarity
            \item After $\Delta$: seasonal spikes remain at lags 12, 24, 36
            \item After $\Delta_{12}$: trend decay remains at early lags
            \item After $\Delta\Delta_{12}$: ACF cuts off $\Rightarrow$ \textbf{stationary}
        \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_acf_differencing.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_acf\_differencing}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_acf_differencing}
\end{frame}

\begin{frame}{Seasonal Integration}
    \begin{cminipage}{0.95\textwidth}
    \begin{defn}[Seasonally Integrated Process]
        A series $Y_t$ is \textbf{seasonally integrated} of order $(d, D)_s$, written $Y_t \sim I(d, D)_s$, if:
        $$(1-L)^d (1-L^s)^D Y_t$$
        is stationary.
    \end{defn}

    \vspace{0.1cm}

    \begin{exampleblock}{Common Cases}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $I(1,0)_{12}$: Regular unit root only (monthly)
            \item $I(0,1)_{12}$: Seasonal unit root only
            \item $I(1,1)_{12}$:
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Both regular and seasonal unit roots
                \end{itemize}
            \end{itemize}
    \end{exampleblock}
    \end{cminipage}
\end{frame}

%=============================================================================
% SECTION 3: SARIMA MODEL DEFINITION
%=============================================================================
\section{The SARIMA Model}

\begin{frame}{SARIMA: Visual Illustration}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.62\textheight, keepaspectratio]{ch4_def_sarima.pdf}
    \end{center}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{exampleblock}{}
    \begin{itemize}
        \item Original $\Rightarrow$ regular difference (removes trend) $\Rightarrow$ seasonal difference (removes seasonality)
        \item Apply minimum differencing needed to achieve stationarity
    \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
    \quantlet{TSA\_ch4\_sarima\_model}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_sarima_model}
\end{frame}

\begin{frame}{SARIMA Model Definition}
    \begin{cminipage}{0.95\textwidth}
    \begin{defn}[SARIMA$(p,d,q)\times(P,D,Q)_s$]
        The \textbf{Seasonal ARIMA} model is:
        $$\phi(L)\Phi(L^s)(1-L)^d(1-L^s)^D Y_t = c + \theta(L)\Theta(L^s)\varepsilon_t$$
    \end{defn}

    {\footnotesize
    \begin{block}{Components}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $\phi(L) = 1 - \phi_1 L - \cdots - \phi_p L^p$: Non-seasonal AR
            \item $\Phi(L^s) = 1 - \Phi_1 L^s - \cdots - \Phi_P L^{Ps}$: Seasonal AR
            \item $\theta(L) = 1 + \theta_1 L + \cdots + \theta_q L^q$: Non-seasonal MA
            \item $\Theta(L^s) = 1 + \Theta_1 L^s + \cdots + \Theta_Q L^{Qs}$: Seasonal MA
            \item $(1-L)^d$:
                \begin{itemize}\setlength{\itemsep}{0pt}
                    \item Regular differencing; $(1-L^s)^D$: Seasonal differencing
                \end{itemize}
            \end{itemize}
    \end{block}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Proof: Multiplicative Seasonal Structure}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \textbf{Why multiplicative?} Consider SARIMA$(1,0,0)\times(1,0,0)_s$:
    $$(1-\phi L)(1-\Phi L^s)Y_t = \varepsilon_t$$

    \vspace{0.1cm}
    \textbf{Expand:}
    $(1-\phi L)(1-\Phi L^s)Y_t = Y_t - \phi Y_{t-1} - \Phi Y_{t-s} + \phi\Phi Y_{t-s-1}$

    \vspace{0.1cm}
    \begin{block}{Interpretation (Monthly, $s=12$)}
        $Y_t$ depends on: $Y_{t-1}$ (last month), $Y_{t-12}$ (same month last year), $Y_{t-13}$ (interaction).

        \textbf{Parsimony}: Multiplicative form uses 2 parameters ($\phi, \Phi$); additive would need 3+.
    \end{block}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{SARIMA Notation}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \begin{block}{Full Specification}
        SARIMA$(p,d,q)\times(P,D,Q)_s$ has 7 parameters to specify:
    \end{block}

    \vspace{0.05cm}

    \begin{table}
        \centering
        \small
        \begin{tabular}{ll}
            \toprule
            \textbf{Parameter} & \textbf{Meaning} \\
            \midrule
            $p$ & Non-seasonal AR order \\
            $d$ & Non-seasonal differencing order \\
            $q$ & Non-seasonal MA order \\
            $P$ & Seasonal AR order \\
            $D$ & Seasonal differencing order \\
            $Q$ & Seasonal MA order \\
            $s$ & Seasonal period \\
            \bottomrule
        \end{tabular}
    \end{table}

    \vspace{0.05cm}

    \begin{exampleblock}{Example}
        {\small SARIMA$(1,1,1)\times(1,1,1)_{12}$: Monthly data with AR(1), MA(1), seasonal AR(1), seasonal MA(1), and both regular and seasonal differencing.}
    \end{exampleblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Common SARIMA Models}
    \vspace{-0.2cm}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Airline Model: SARIMA$(0,1,1)\times(0,1,1)_s$}
        $(1-L)(1-L^s)Y_t = (1+\theta L)(1+\Theta L^s)\varepsilon_t$ -- Classic model (Box \& Jenkins, 1970)
    \end{block}

    \begin{block}{SARIMA$(1,0,0)\times(1,0,0)_s$}
        $(1-\phi L)(1-\Phi L^s)Y_t = \varepsilon_t$ -- Pure seasonal and non-seasonal AR
    \end{block}

    \begin{block}{SARIMA$(0,1,1)\times(0,1,0)_s$}
        $(1-L)(1-L^s)Y_t = (1+\theta L)\varepsilon_t$ -- Random walk + seasonal diff + MA(1)
    \end{block}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SECTION 4: SEASONAL ACF AND PACF
%=============================================================================
\section{Seasonal ACF and PACF Patterns}

\begin{frame}{ACF/PACF for Seasonal Models}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Key Insight}
        Seasonal models show patterns at both:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Non-seasonal lags: $1, 2, 3, \ldots$
            \item Seasonal lags: $s, 2s, 3s, \ldots$
        \end{itemize}
    \end{block}

    \vspace{0.1cm}

    \begin{table}
        \centering
        \small
        \begin{tabular}{lcc}
            \toprule
            \textbf{Model} & \textbf{ACF} & \textbf{PACF} \\
            \midrule
            SAR($P$) & Decays at $s, 2s, \ldots$ & Cuts off after $Ps$ \\
            SMA($Q$) & Cuts off after $Qs$ & Decays at $s, 2s, \ldots$ \\
            SARMA & Decays at seasonal lags & Decays at seasonal lags \\
            \bottomrule
        \end{tabular}
    \end{table}
    \end{cminipage}
\end{frame}

\begin{frame}{Example: Airline Model ACF/PACF}
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.78\textheight, keepaspectratio]{ch4_acf_pacf.pdf}
    \end{center}
\end{frame}

\begin{frame}{Example: Airline Model ACF/PACF}
    \begin{cminipage}{0.95\textwidth}
    {\footnotesize
    \begin{columns}[T]
        \column{0.48\textwidth}
        \begin{block}{ACF: $\Delta\Delta_{12}\log(Y_t)$}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Spike at lag 1 $\leftarrow$ MA(1), $\theta$
                \item Spike at lag 12 $\leftarrow$ SMA(1), $\Theta$
                \item Rest $\approx$ zero
            \end{itemize}
        \end{block}
        \column{0.48\textwidth}
        \begin{block}{PACF: exponential decay}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Decays at lags $1, 2, 3, \ldots$
                \item Decays at lags $12, 24, 36$
                \item $\Rightarrow$ \textbf{MA, not AR}
            \end{itemize}
        \end{block}
    \end{columns}
    }
    \begin{alertblock}{}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Conclusion}: ACF cuts off $\Rightarrow$ MA; PACF decays $\Rightarrow$ not AR. Model: $(0,1,1)\times(0,1,1)_{12}$
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Model Identification Guidelines}
    \vspace{-0.1cm}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Step-by-Step Process}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item Examine ACF for slow decay at seasonal lags $\Rightarrow$ seasonal differencing
            \item After differencing, check ACF/PACF patterns
            \item Non-seasonal behavior at lags $1, 2, \ldots, s-1$
            \item Seasonal behavior at lags $s, 2s, 3s, \ldots$
        \end{enumerate}
    \end{block}

    \vspace{0.1cm}

    \begin{alertblock}{Practical Tips}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Start with $d \leq 1$ and $D \leq 1$
            \item Usually $P, Q \leq 2$ is sufficient
            \item Use information criteria (AIC, BIC) for final selection
            \item Auto-SARIMA algorithms can help
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SECTION 5: ESTIMATION AND DIAGNOSTICS
%=============================================================================
\section{Estimation and Diagnostics}

\begin{frame}{Estimation Methods}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Maximum Likelihood Estimation}
        Standard approach for SARIMA:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Conditional MLE (conditional on initial values)
            \item Exact MLE (via Kalman filter)
        \end{itemize}
    \end{block}

    \vspace{0.1cm}

    \begin{block}{Computational Considerations}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item More parameters than ARIMA $\Rightarrow$ more data needed
            \item Seasonal parameters estimated from lags $s, 2s, \ldots$
            \item Need sufficient seasonal cycles (at least 3-4 years of monthly data)
        \end{itemize}
    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Exact Likelihood: Prediction Error Decomposition}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.3cm}
    {\footnotesize
    \begin{block}{Why the Kalman Filter?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{SARIMA}: has the structure of a state-space model
            \item \textbf{Kalman filter}: recursively computes prediction errors $v_t$ and their variances $f_t$, without conditioning on initial values
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{block}{Exact Log-Likelihood (Prediction Error Decomposition)}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Formula}: $\ell(\boldsymbol{\theta}) = -\frac{T}{2}\ln(2\pi) - \frac{1}{2}\sum_{t=1}^{T}\left[\ln(f_t) + \frac{v_t^2}{f_t}\right]$
            \item \textbf{$v_t$}: $Y_t - \hat{Y}_{t|t-1}$ (innovation); \textbf{$f_t$}: $\text{Var}(v_t)$ (innovation variance)
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{exampleblock}{Advantages over Conditional MLE}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Does not require choosing initial values
            \item Each term $\ln(f_t)$ weights observations differently (variable variance at start)
            \item Essential for short series where initial values matter
            \item Implemented by default in \texttt{statsmodels.tsa.SARIMAX()} with \texttt{method='mle'}
        \end{itemize}
    \end{exampleblock}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Stationarity and Invertibility}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Stationarity Conditions}
        Both non-seasonal and seasonal AR polynomials must have roots outside the unit circle:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $\phi(z) = 0 \Rightarrow |z| > 1$
            \item $\Phi(z^s) = 0 \Rightarrow |z| > 1$
        \end{itemize}
    \end{block}

    \vspace{0.1cm}

    \begin{block}{Invertibility Conditions}
        Both non-seasonal and seasonal MA polynomials must have roots outside the unit circle:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $\theta(z) = 0 \Rightarrow |z| > 1$
            \item $\Theta(z^s) = 0 \Rightarrow |z| > 1$
        \end{itemize}
    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Diagnostic Checking}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Residual Analysis}
        After fitting SARIMA, check that residuals are white noise:
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item Plot residuals over time (no patterns)
            \item ACF of residuals (no significant spikes)
            \item Ljung-Box test at multiple lags including seasonal
            \item Normality tests (Q-Q plot, Jarque-Bera)
        \end{enumerate}
    \end{block}

    \vspace{0.1cm}

    \begin{alertblock}{Important}
        Check ACF at \textbf{both} non-seasonal and seasonal lags!

        Significant ACF at lag 12 suggests inadequate seasonal modeling.
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Model Selection Criteria}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Information Criteria}
        Compare competing SARIMA models using:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item AIC = $-2\ln(L) + 2k$
            \item BIC = $-2\ln(L) + k\ln(n)$
            \item AICc = AIC + $\frac{2k(k+1)}{n-k-1}$ (corrected for small samples)
        \end{itemize}
        where $k = p + q + P + Q + 1$ (plus 1 for variance).
    \end{block}

    \vspace{0.1cm}

    \begin{exampleblock}{Auto-SARIMA}
        Python's \texttt{pmdarima.auto\_arima()} with \texttt{seasonal=True} automatically searches for optimal $(p,d,q)\times(P,D,Q)_s$.
    \end{exampleblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Hyndman-Khandakar Algorithm (\texttt{auto\_arima})}
    \vspace{-0.15cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{How does automatic selection work? (Hyndman \& Khandakar, 2008)}
        \vspace{-3pt}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item \textbf{$d$}: successive KPSS tests ($d = 0, 1, 2$); \textbf{$D$}: OCSB or Canova-Hansen test ($D = 0, 1$)
            \item \textbf{Stepwise search}: starts from initial model, explores neighboring models
            \item \textbf{Criterion}: AICc (correct for small samples)
        \end{enumerate}
        \vspace{-3pt}
    \end{block}

    \begin{exampleblock}{Search Strategy}
        \vspace{-3pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Initial model}: SARIMA$(2,d,2)(1,D,1)_s$ or SARIMA$(0,d,0)(0,D,0)_s$
            \item \textbf{Variations tested}: $\pm 1$ for each order ($p, q, P, Q$); stops when no neighbor improves AICc
            \item \textbf{Complexity}: $O(20\text{-}30)$ models evaluated (vs.\ $O(k^4)$ for grid search)
        \end{itemize}
        \vspace{-3pt}
    \end{exampleblock}

    \begin{alertblock}{Python: \texttt{pm.auto\_arima(y, seasonal=True, m=12, stepwise=True, trace=True)}}
        \vspace{-3pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Set \texttt{stepwise=False} for exhaustive search (slower, sometimes better)
        \end{itemize}
        \vspace{-3pt}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SECTION 6: FORECASTING
%=============================================================================
\section{Forecasting with SARIMA}

\begin{frame}{Point Forecasts}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Forecast Computation}
        SARIMA forecasts are computed recursively:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Replace future $\varepsilon_{T+h}$ with 0
            \item Replace future $Y_{T+h}$ with forecasts $\hat{Y}_{T+h|T}$
            \item Use known past values $Y_T, Y_{T-1}, \ldots$
        \end{itemize}
    \end{block}

    \vspace{0.1cm}

    \begin{exampleblock}{Seasonal Pattern in Forecasts}
        SARIMA forecasts naturally capture seasonality:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Short-term: influenced by recent values
            \item Long-term: revert to seasonal pattern
        \end{itemize}
    \end{exampleblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Forecast Intervals}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Uncertainty Quantification}
        $(1-\alpha)$\% prediction interval:
        $$\hat{Y}_{T+h|T} \pm z_{\alpha/2} \sqrt{\Var(e_{T+h})}$$

        Variance computed from MA($\infty$) representation.
    \end{block}

    \vspace{0.1cm}

    \begin{alertblock}{Key Properties}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Intervals widen with forecast horizon
            \item For $I(1,1)_s$ series: intervals grow without bound
            \item Seasonal pattern visible in point forecasts
            \item Uncertainty captures both trend and seasonal variation
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Long-Horizon Forecasts}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Behavior as $h \to \infty$}
        \begin{itemize}
            \item Point forecasts converge to deterministic seasonal pattern
            \item If drift present: linear trend + seasonal pattern
            \item Forecast intervals continue to widen
        \end{itemize}
    \end{block}

    \vspace{0.1cm}

    \begin{exampleblock}{Practical Implication}
        \begin{itemize}
            \item Short-term: SARIMA captures both short-term dynamics and season
            \item Medium-term: Good seasonal forecasts, growing uncertainty
            \item Long-term: Mainly reflects seasonal pattern, wide intervals
        \end{itemize}
    \end{exampleblock}
    \end{cminipage}
\end{frame}

\begin{frame}{The Seasonal Naive Benchmark}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Definition: Seasonal Naive Forecast}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Formula}: $\hat{Y}_{T+h} = Y_{T+h-s}$ \quad (last observed season)
            \item \textbf{Monthly example}: Forecast for March 2025 = value from March 2024
            \item \textbf{Interpretation}: ``The simplest model that respects seasonality''
        \end{itemize}
    \end{block}

    \begin{exampleblock}{Why is it essential?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Any SARIMA model \textbf{must} outperform the seasonal naive benchmark
            \item If it doesn't $\Rightarrow$ the model complexity is not justified
            \item Surprisingly effective for many series with stable seasonality
        \end{itemize}
    \end{exampleblock}

    \begin{alertblock}{Golden Rule}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Always} report SARIMA performance relative to seasonal naive
            \item This is the \textbf{first thing} a reviewer or manager checks
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{The MASE Metric: Proper Evaluation for Seasonal Series}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{MASE --- Mean Absolute Scaled Error (Hyndman \& Koehler, 2006)}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Formula}: $\text{MASE} = \frac{\frac{1}{H}\sum_{h=1}^{H}|e_{T+h}|}{\frac{1}{T-s}\sum_{t=s+1}^{T}|Y_t - Y_{t-s}|}$
            \item \textbf{Numerator}: mean absolute error of the model
            \item \textbf{Denominator}: mean absolute error of seasonal naive (on training data)
        \end{itemize}
        \vspace{-2pt}
    \end{block}
    \vspace{-0.1cm}
    \begin{block}{Interpretation}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item $\text{MASE} < 1$: Model is \textbf{better} than seasonal naive
            \item $\text{MASE} = 1$: Model is \textbf{equivalent} to seasonal naive
            \item $\text{MASE} > 1$: Model is \textbf{worse} --- abandon it!
        \end{itemize}
        \vspace{-2pt}
    \end{block}
    \vspace{-0.1cm}
    \begin{alertblock}{Why MASE and not MAPE?}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item MAPE: undefined for $Y_t = 0$; asymmetric; scale-dependent
            \item MASE: works with any data; symmetric; comparable across different series
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{Forecast Evaluation: Rolling Forecast Origin}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Cross-Validation for Seasonal Time Series}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Principle}: re-estimate model $\to$ forecast $h$ steps $\to$ advance 1 step $\to$ repeat
            \item \textbf{Fixed window}: training on last $w$ observations (constant size)
            \item \textbf{Expanding window}: training from beginning to $T+i$ (grows)
        \end{itemize}
        \vspace{-2pt}
    \end{block}

    \begin{exampleblock}{Step-by-step procedure}
        \vspace{-2pt}
        \begin{enumerate}\setlength{\itemsep}{0pt}
            \item Train SARIMA on $Y_1, \ldots, Y_T$; forecast $\hat{Y}_{T+1}, \ldots, \hat{Y}_{T+h}$
            \item Train SARIMA on $Y_1, \ldots, Y_{T+1}$; forecast $\hat{Y}_{T+2}, \ldots, \hat{Y}_{T+h+1}$
            \item $\ldots$ repeat $N$ times; compute RMSE, MAE, MASE on all $N$ forecasts
        \end{enumerate}
        \vspace{-2pt}
    \end{exampleblock}

    \begin{alertblock}{Important}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Minimum $N \geq 2s$ origins (2 complete seasonal cycles) for reliable results
            \item Never ``look ahead'' --- test data is strictly after training data
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{SARIMA vs Holt-Winters/ETS: When to Use Which?}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Comparison}
        \begin{center}
        \resizebox{\linewidth}{!}{%
        \begin{tabular}{p{2.2cm}p{4cm}p{4cm}}
            \toprule
            \textbf{Criterion} & \textbf{SARIMA} & \textbf{ETS / Holt-Winters} \\
            \midrule
            Approach & Box-Jenkins (ACF/PACF) & Exponential smoothing \\
            Seasonality & Stochastic (differencing) & Additive or multiplicative \\
            Interpretation & AR/MA coefficients & Smoothing weights $\alpha, \beta, \gamma$ \\
            Flexibility & Very flexible (7 params.) & Less flexible \\
            Automation & \texttt{auto\_arima} & \texttt{ets()} / \texttt{ExponentialSmoothing} \\
            \bottomrule
        \end{tabular}}
        \end{center}
    \end{block}

    \begin{exampleblock}{Practical Selection Guide}
        \begin{itemize}\setlength{\itemsep}{1pt}
            \item \textbf{SARIMA preferred}: series with complex autocorrelation, stochastic seasonality, ARMA components
            \item \textbf{ETS preferred}: short series, stable seasonality, quick forecasts without diagnostics
            \item \textbf{Best}: compare both on out-of-sample data and choose the winner
        \end{itemize}
    \end{exampleblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SECTION 7: CASE STUDY - AIRLINE PASSENGERS
%=============================================================================
\section{Case Study: Airline Passengers}

\begin{frame}{Case Study: Airline Passengers Data}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Classic Box-Jenkins dataset: monthly airline passengers (1949-1960)
                \item Clear upward trend and increasing seasonal amplitude
                \item Multiplicative seasonality suggests log transformation
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_raw_data.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_raw\_data}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_raw_data}
\end{frame}

\begin{frame}{Data Splitting Strategy}
    \begin{cminipage}{0.95\textwidth}
    \begin{center}
        \includegraphics[width=0.88\textwidth, height=0.42\textheight, keepaspectratio]{train_val_test_split.pdf}
    \end{center}
    \vspace{-0.4cm}
    {\scriptsize
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item \textbf{Training set (70\%)} --- Fit model parameters; estimate SARIMA coefficients ($\phi$, $\theta$, $\Phi$, $\Theta$)
        \item \textbf{Validation set (15\%)} --- Select best model; compare candidates, choose lowest validation error
        \item \textbf{Test set (15\%)} --- Final evaluation; unbiased out-of-sample performance, never used during development
    \end{itemize}
    }
    \end{cminipage}
\end{frame}

\begin{frame}{Step 1: Transformations}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Log transform stabilizes variance (multiplicative $\Rightarrow$ additive)
                \item First difference removes trend; seasonal difference removes seasonality
                \item Double-differenced series appears stationary
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_transformations.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_transformations}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_transformations}
\end{frame}

\begin{frame}{Step 2: ACF/PACF Analysis}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item ACF: Significant spike at lag 1 and lag 12 $\Rightarrow$ MA(1), SMA(1)
                \item PACF: Exponential decay pattern confirms MA structure
                \item Suggests SARIMA$(0,1,1)\times(0,1,1)_{12}$ (airline model)
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_acf_pacf.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_acf\_pacf}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_acf_pacf}
\end{frame}

\begin{frame}{Step 3: Model Comparison}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Compare candidate SARIMA models using AIC criterion
                \item SARIMA$(0,1,1)\times(0,1,1)_{12}$ provides best fit (lowest AIC)
                \item This is the famous ``airline model'' identified by Box \& Jenkins
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_model_comparison.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_model\_comparison}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_model_comparison}
\end{frame}

\begin{frame}{Step 4: Residual Diagnostics}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Residuals appear random with no remaining autocorrelation
                \item Q-Q plot shows approximate normality
                \item Model adequately captures both trend and seasonal structure
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_diagnostics.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_diagnostics}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_diagnostics}
\end{frame}

\begin{frame}{Step 5: Forecasting}
    \vspace{-0.2cm}
    {\footnotesize
        \begin{exampleblock}{}
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item 24-month forecast with 95\% confidence interval
                \item Model captures seasonal pattern and upward trend
                \item Prediction intervals widen appropriately with forecast horizon
            \end{itemize}
        \end{exampleblock}
        }
    \begin{center}
        \includegraphics[width=0.95\textwidth, height=0.50\textheight, keepaspectratio]{ch4_case_forecast.pdf}
    \end{center}
    \quantlet{TSA\_ch4\_case\_forecast}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_case_forecast}
\end{frame}

%=============================================================================
% SECTION 8: PRACTICAL ASPECTS
%=============================================================================
\section{Practical Aspects}

\begin{frame}{Practical Pitfalls in SARIMA Modeling}
    \vspace{-0.2cm}
    {\scriptsize
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{1. Over-differencing}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Symptom}: ACF at lag 1 $\approx -0.5$ (regular) or at lag $s$ $\approx -0.5$ (seasonal)
            \item \textbf{Cause}: applying $(1-L)$ or $(1-L^s)$ too many times
            \item \textbf{Solution}: reduce $d$ or $D$ by 1 and re-examine ACF/PACF
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}

    \begin{alertblock}{2. Insufficient Data}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Minimum}: 3--4 complete seasonal cycles (36--48 monthly obs.); \textbf{recommended}: 5+ cycles
            \item Seasonal parameters $\Phi, \Theta$ are estimated from lags $s, 2s, 3s, \ldots$
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}

    \begin{alertblock}{3. Other Common Pitfalls}
        \vspace{-2pt}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Root cancellation}: $\phi \approx \theta$ suggests over-parameterization
            \item \textbf{Parameters at invertibility boundary}: $|\theta| \approx 1$ or $|\Theta| \approx 1$ indicates problems
            \item \textbf{Forgetting inverse transformation}: forecasts on log scale must be back-transformed!
        \end{itemize}
        \vspace{-2pt}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{X-13ARIMA-SEATS: Official Seasonal Adjustment}
    \vspace{-0.2cm}
    {\footnotesize
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{What is seasonal adjustment?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Goal}: remove the seasonal component to reveal the true trend
            \item \textbf{Users}: Eurostat, US Census Bureau, central banks, national statistical offices
            \item \textbf{Example}: ``GDP grew 0.3\% compared to previous quarter'' (seasonally adjusted data)
        \end{itemize}
    \end{block}
    \vspace{-0.1cm}
    \begin{exampleblock}{X-13ARIMA-SEATS (US Census Bureau)}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Step 1}: Identify and estimate a regARIMA model (SARIMA + calendar effects)
            \item \textbf{Step 2}: Extract the seasonal component via SEATS or X-11 filters
            \item \textbf{Step 3}: $Y_t^{adjusted} = Y_t - \hat{S}_t$ (additive) or $Y_t^{adjusted} = Y_t / \hat{S}_t$ (multiplicative)
        \end{itemize}
    \end{exampleblock}
    \vspace{-0.1cm}
    \begin{alertblock}{Why does it matter for economists?}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Published macroeconomic data is almost always seasonally adjusted
            \item Misinterpreting unadjusted data can lead to erroneous conclusions
        \end{itemize}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
\section{AI Use Case}
%=============================================================================

\begin{frame}{AI Exercise: Critical Thinking}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \vspace{-3mm}
    \begin{block}{\footnotesize Prompt to test in ChatGPT / Claude / Copilot}
        {\footnotesize
        ``I have the \texttt{AirPassengers} dataset from statsmodels (monthly data, international airline passengers, 1949--1960, 144 obs.). Identify seasonality, apply Box-Cox transform if needed, estimate a SARIMA model, and forecast 12 months. Give me complete Python code with plots.''
        }
    \end{block}
    \vspace{-2mm}
    {\footnotesize
    \textbf{Exercise}:
    \begin{enumerate}\setlength{\itemsep}{0pt}
        \item Run the prompt in an LLM of your choice and critically analyze the response.
        \item Does it check seasonality with ACF at lags $s, 2s, 3s$? Does it use STL decomposition?
        \item Does it apply Box-Cox \textit{before} differencing? Does it justify the choice of $\lambda$?
        \item How does it choose orders $(p,d,q)\times(P,D,Q)_s$? Only auto\_arima or also ACF/PACF?
        \item Does it evaluate with MASE relative to seasonal na\"ive? Does it use rolling forecast?
    \end{enumerate}
    }
    \vspace{-2mm}
    \begin{alertblock}{}
        {\footnotesize \textbf{Warning}: AI-generated code may run without errors and look professional. \textit{That does not mean it is correct.}}
    \end{alertblock}
    \end{cminipage}
    }
\end{frame}

%=============================================================================
% SUMMARY
%=============================================================================
\section{Summary}

\begin{frame}{Summary}
    \vspace{-0.3cm}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{What We Learned in This Chapter}
        \begin{itemize}\setlength{\itemsep}{1pt}
            \item Seasonality in time series
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Repetitive patterns at regular intervals; additive vs multiplicative
            \end{itemize}
            \item Seasonal differencing and Box-Cox transformation
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item $(1-L^s)$ removes stochastic seasonality; Box-Cox stabilizes variance
            \end{itemize}
            \item SARIMA$(p,d,q)\times(P,D,Q)_s$ models
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Extend ARIMA with seasonal components; automatic selection via \texttt{auto\_arima}
            \end{itemize}
            \item Forecasting and evaluation
            \begin{itemize}\setlength{\itemsep}{0pt}
                \item Benchmark: MASE relative to seasonal naive; rolling forecast out-of-sample
            \end{itemize}
        \end{itemize}
    \end{block}
    \begin{exampleblock}{Key Idea}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Parsimony principle}: The Airline Model $(0,1,1)\times(0,1,1)_{12}$ with only 2 parameters is remarkably effective for many seasonal economic series.
        \end{itemize}
    \end{exampleblock}
    \end{cminipage}
    }
\end{frame}
\begin{frame}{What's Next?}
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Chapter 5: Volatility Modeling --- GARCH}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Volatility}: conditional variation of financial returns
            \item \textbf{ARCH/GARCH}: models for conditional variance
            \item \textbf{Asymmetric extensions}: GJR-GARCH, EGARCH (leverage effect)
            \item \textbf{VaR}: Value-at-Risk based on GARCH models
            \item \textbf{Case study}: S\&P 500 returns volatility
        \end{itemize}
    \end{block}

    \vspace{0.3cm}
    \begin{center}
        \Large\textcolor{MainBlue}{Questions?}
    \end{center}
    \end{cminipage}
\end{frame}

%=============================================================================
% SECTION 9: QUIZ
%=============================================================================
\section{Quiz}

\begin{frame}{Question 1}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item For monthly data with annual seasonality, what is the seasonal period $s$?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} $s = 4$\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} $s = 7$\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} $s = 12$\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} $s = 52$

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 1: Answer}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    \begin{center}
        \includegraphics[width=0.98\textwidth, height=0.58\textheight, keepaspectratio]{ch4_quiz1_seasonal_periods.pdf}
    \end{center}
    \vspace{-3mm}
    {\small
    \begin{exampleblock}{Answer: (C)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item $s = 12$ (12 months per year). Common periods: Quarterly=4, Monthly=12, Weekly=52, Daily=7, Hourly=24
    \end{itemize}
    \end{exampleblock}
    }
    \hfill\quantlet{TSA\_ch4\_quiz1\_seasonal\_periods}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_quiz1_seasonal_periods}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 2}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item What does the seasonal difference operator $(1 - L^{12})$ do to a monthly series?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} Computes $Y_t - Y_{t-1}$ (month-to-month change)\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} Computes $Y_t - Y_{t-12}$ (year-over-year change)\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} Computes the 12-month moving average\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} Removes the trend component only

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 2: Answer}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    \begin{center}
        \includegraphics[width=0.98\textwidth, height=0.58\textheight, keepaspectratio]{ch4_quiz2_seasonal_diff.pdf}
    \end{center}
    \vspace{-3mm}
    {\small
    \begin{exampleblock}{Answer: (B)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item $(1 - L^{12})Y_t = Y_t - Y_{t-12}$ removes the seasonal pattern by comparing same months.
    \end{itemize}
    \end{exampleblock}
    }
    \hfill\quantlet{TSA\_ch4\_quiz2\_seasonal\_diff}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_quiz2_seasonal_diff}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 3}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item In SARIMA$(1,1,1)\times(1,1,1)_{12}$ notation, what does the $(1,1,1)_{12}$ part represent?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} AR(1), differencing once, MA(1) at the regular level\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} Seasonal AR(1), seasonal differencing once, seasonal MA(1)\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} 12 AR terms, 12 differences, 12 MA terms\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} The model has 12 parameters in total

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 3: Answer}
    \begin{cminipage}{0.95\textwidth}
    {\small
    \begin{exampleblock}{Answer: (B)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item Seasonal AR(1), seasonal differencing once, seasonal MA(1)
    \end{itemize}
    \end{exampleblock}
    }

    \begin{block}{SARIMA Notation Breakdown}
        SARIMA$(p,d,q)\times(P,D,Q)_s$:

        \vspace{0.1cm}
        \begin{tabular}{ll}
            $(p,d,q)$ & Non-seasonal: AR($p$), $d$ differences, MA($q$) \\
            $(P,D,Q)_s$ & Seasonal: SAR($P$), $D$ seasonal diffs, SMA($Q$) \\
        \end{tabular}

        \vspace{0.15cm}
        For $(1,1,1)\times(1,1,1)_{12}$:
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Non-seasonal: AR(1), one regular difference, MA(1)
            \item Seasonal: SAR(1) at lag 12, one $\Delta_{12}$, SMA(1) at lag 12
        \end{itemize}
    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 4}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item The ``Airline Model'' is SARIMA$(0,1,1)\times(0,1,1)_{12}$. How many parameters need to be estimated (excluding variance)?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} 1\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} 2\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} 4\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} 12

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 4: Answer}
    \begin{cminipage}{0.95\textwidth}
    {\small
    \begin{exampleblock}{Answer: (B)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item 2 parameters: SARIMA$(0,1,1)\times(0,1,1)_{12}$: $(1-L)(1-L^{12})Y_t = (1 + \theta_1 L)(1 + \Theta_1 L^{12})\varepsilon_t$
        \item Parameters: $\theta_1$ (non-seasonal MA) and $\Theta_1$ (seasonal MA), plus $\sigma^2$.
    \end{itemize}
    \end{exampleblock}
    }

    \begin{alertblock}{Why ``Airline Model''?}
        Box \& Jenkins (1970) used this model to forecast international airline passengers. Remarkably effective for many seasonal economic series!
    \end{alertblock}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 5}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item You observe significant ACF spikes at lags 12, 24, and 36 in a monthly series. What does this suggest?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} The series has a unit root\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} The series has annual seasonality that needs seasonal differencing\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} The series follows an AR(36) process\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} The series is already stationary

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 5: Answer}
    \begin{cminipage}{0.95\textwidth}
    \vspace{-0.2cm}
    \begin{center}
        \includegraphics[width=0.98\textwidth, height=0.58\textheight, keepaspectratio]{ch4_quiz5_seasonal_acf.pdf}
    \end{center}
    \vspace{-3mm}
    {\small
    \begin{exampleblock}{Answer: (B)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item ACF spikes at 12, 24, 36 = stochastic seasonality. Apply $(1 - L^{12})$ to remove it.
    \end{itemize}
    \end{exampleblock}
    }
    \hfill\quantlet{TSA\_ch4\_quiz5\_seasonal\_acf}{https://github.com/QuantLet/TSA/tree/main/TSA_ch4/TSA_ch4_quiz5_seasonal_acf}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 6}
    \begin{cminipage}{0.95\textwidth}
    \begin{alertblock}{Question}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item After applying $(1-L)(1-L^{12})$ to a monthly series, the ACF shows a significant spike only at lag 1 and lag 12. What SARIMA model is suggested?
        \end{itemize}
    \end{alertblock}

    \vspace{0.3cm}

    \begin{block}{Answer Choices}

        \textcolor{MainBlue}{\textbf{(A)}} SARIMA$(1,1,0)\times(1,1,0)_{12}$\\[3pt]

        \textcolor{MainBlue}{\textbf{(B)}} SARIMA$(0,1,1)\times(0,1,1)_{12}$\\[3pt]

        \textcolor{MainBlue}{\textbf{(C)}} SARIMA$(1,1,1)\times(1,1,1)_{12}$\\[3pt]

        \textcolor{MainBlue}{\textbf{(D)}} SARIMA$(0,1,0)\times(0,1,0)_{12}$

    \end{block}
    \end{cminipage}
\end{frame}

\begin{frame}{Question 6: Answer}
    \begin{cminipage}{0.95\textwidth}
    {\small
    \begin{exampleblock}{Answer: (B)}
    \begin{itemize}\setlength{\itemsep}{0pt}
        \item \textbf{Model}: SARIMA$(0,1,1)\times(0,1,1)_{12}$ (The Airline Model)
    \end{itemize}
    \end{exampleblock}
    }

    \begin{block}{ACF/PACF Identification Rules}
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Rule}: for MA processes, ACF cuts off after lag $q$
            \item \textbf{ACF spike at lag 1}: MA(1) for non-seasonal part
            \item \textbf{ACF spike at lag 12}: SMA(1) for seasonal part
            \item \textbf{Combined}: MA(1) $\times$ SMA(1) = $(0,d,1)\times(0,D,1)_{12}$
            \item \textbf{With $d=1$, $D=1$}: $(0,1,1)\times(0,1,1)_{12}$
        \end{itemize}
    \end{block}
    \end{cminipage}
\end{frame}


%=============================================================================
% BIBLIOGRAPHY
%=============================================================================
\begin{frame}{References I}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Seasonal Models -- Foundational Works}
        {\small
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Box, G.E.P., Jenkins, G.M., Reinsel, G.C., \& Ljung, G.M. (2015). \textit{Time Series Analysis: Forecasting and Control}, 5th ed., Wiley.
            \item Hylleberg, S., Engle, R.F., Granger, C.W.J., \& Yoo, B.S. (1990). Seasonal Integration and Cointegration, \textit{Journal of Econometrics}, 44(1-2), 215--238.
            \item Canova, F., \& Hansen, B.E. (1995). Are Seasonal Patterns Constant Over Time?, \textit{Journal of Business \& Economic Statistics}, 13(3), 237--252.
        \end{itemize}
        }
    \end{block}

    \begin{exampleblock}{Seasonal Decomposition and Diagnostics}
        {\small
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Cleveland, R.B., Cleveland, W.S., McRae, J.E., \& Terpenning, I. (1990). STL: A Seasonal-Trend Decomposition Procedure Based on Loess, \textit{Journal of Official Statistics}, 6(1), 3--33.
            \item Hyndman, R.J., \& Athanasopoulos, G. (2021). \textit{Forecasting: Principles and Practice}, 3rd ed., OTexts.
        \end{itemize}
        }
    \end{exampleblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{References II}
    {\small
    \begin{cminipage}{0.95\textwidth}
    \begin{block}{Textbooks and Additional References}
        {\small
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item Shumway, R.H., \& Stoffer, D.S. (2017). \textit{Time Series Analysis and Its Applications}, 4th ed., Springer.
            \item Brockwell, P.J., \& Davis, R.A. (2016). \textit{Introduction to Time Series and Forecasting}, 3rd ed., Springer.
            \item Hyndman, R.J., \& Khandakar, Y. (2008). Automatic Time Series Forecasting: The \texttt{forecast} Package for R, \textit{Journal of Statistical Software}, 27(3), 1--22.
        \end{itemize}
        }
    \end{block}

    \begin{exampleblock}{Online Resources and Code}
        {\small
        \begin{itemize}\setlength{\itemsep}{0pt}
            \item \textbf{Quantlet}: \url{https://quantlet.com} -- Code platform for quantitative methods
            \item \textbf{Quantinar}: \url{https://quantinar.com} -- Learning platform for quantitative methods
            \item \textbf{GitHub TSA}: \url{https://github.com/QuantLet/TSA/tree/main/TSA_ch4} -- Python code for this chapter
        \end{itemize}
        }
    \end{exampleblock}
    \end{cminipage}
    }
\end{frame}

\begin{frame}{}
    \centering
    \vspace{1cm}

    \Huge\textcolor{MainBlue}{Thank You!}

    \vspace{0.8cm}

    \Large Questions?

    \vspace{1cm}

    \normalsize
    Course materials available at: \url{https://danpele.github.io/Time-Series-Analysis/}

    \vspace{0.3cm}

    \href{https://quantlet.com}{\raisebox{-0.15em}{\includegraphics[height=0.8em]{ql_logo.png}} Quantlet} \hspace{0.5cm}
    \href{https://quantinar.com}{\raisebox{-0.15em}{\includegraphics[height=0.8em]{qr_logo.png}} Quantinar}
\end{frame}

\end{document}
